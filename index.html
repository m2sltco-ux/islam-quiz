<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name='admaven-placement' content=Bqjw7rjnF>
    <title>Quiz Islam - Vrai/Faux avanc√©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        @keyframes pulse {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.1);
            }
        }
        #userPoints.updated {
    animation: pop 0.4s ease-out;
}
@keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); color: #FFD700; }
    100% { transform: scale(1); }
}
#ramadanMiniCalendar .day {
    aspect-ratio: 1 / 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-weight: bold;
    background: rgba(107, 142, 35, 0.25);
    border: 1.5px solid #6B8E2380;
    color: #e2e8f0;
}

#ramadanMiniCalendar .day.today {
    background: #FFD700;
    color: #143C30;
    border-color: #DAA520;
    box-shadow: 0 0 18px #FFD700AA;
    transform: scale(1.12);
}

#ramadanMiniCalendar .day.past {
    opacity: 0.45;
    background: rgba(100,100,100,0.35);
}

#ramadanMiniCalendar .day.future {
    background: rgba(255,215,0,0.12);
}

#claimRamadanGiftBtn:disabled {
    background: linear-gradient(135deg, #475569, #64748b) !important;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}
        /* Minuteur Ramadan - en haut √† droite du menu */
        #ramadanCountdown {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(255, 215, 0, 0.2);
            /* fond or tr√®s l√©ger */
            border: 2px solid #FFD700;
            border-radius: 12px;
            padding: 10px 16px;
            color: #FFD700;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            z-index: 10;
            min-width: 220px;
        }

        #ramadanCountdown span {
            color: #e2e8f0;
            font-size: 1.1rem;
            display: block;
            margin-top: 4px;
        }

        @media (max-width: 600px) {
            #ramadanCountdown {
                position: static;
                margin: 15px auto;
                width: 90%;
                right: auto;
                top: auto;
            }
        }

        /* COULEURS VERT/OR */
        body {
            font-family: 'Amiri', serif;
            /* Vert fonc√© pour le fond */
            background: linear-gradient(135deg, #143C30, #1D483C);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            position: relative
        }

        .box {
            width: 100%;
            max-width: 500px;
            /* Vert plus clair/transparence */
            background: rgba(20, 60, 48, 0.96);
            border-radius: 28px;
            padding: 40px 30px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.8);
            /* Bordure Vert Olive/Kaki */
            border: 2px solid #6B8E23;
            text-align: center
        }

        h1 {
            font-size: 3.4rem;
            /* Or */
            color: #FFD700;
            /* Ombre Or */
            text-shadow: 0 0 30px #DAA520;
            margin-bottom: 20px
        }

        .menu-btn {
            display: block;
            width: 88%;
            margin: 20px auto;
            padding: 22px;
            font-size: 1.75rem;
            font-weight: 700;
            color: #143C30;
            /* Texte fonc√© pour les boutons or */
            /* Gradient Or/Bronze */
            background: linear-gradient(135deg, #FFD700, #B8860B);
            border: none;
            border-radius: 60px;
            cursor: pointer;
            /* Ombre Or */
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.5);
            transition: all .4s
        }

        .menu-btn:hover {
            transform: translateY(-8px)
        }

        /* Bouton d√©sactiv√© (general) */
        .menu-btn:disabled {
            background: linear-gradient(135deg, #475569, #64748b) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transform: none !important;
            cursor: default;
        }

        /* Couleurs secondaires */
        .infinite-btn {
            background: linear-gradient(135deg, #a0522d, #cd853f) !important;
            /* Marron Sienne (Terre) */
            color: #e2e8f0;
        }

        .success-btn {
            background: linear-gradient(135deg, #006400, #228b22) !important;
            /* Vert (Success) */
            color: #e2e8f0;
        }

        .danger-btn {
            background: linear-gradient(135deg, #8b0000, #dc143c) !important;
            /* Rouge (Danger) */
            font-size: 1.4rem;
            padding: 16px;
            color: #e2e8f0;
        }

        .settings-btn {
            background: linear-gradient(135deg, #4f4f4f, #696969);
            /* Gris/Ardoise */
            font-size: 1.5rem;
            padding: 18px;
            color: #e2e8f0;
        }

        .chrono-btn {
            background: linear-gradient(135deg, #800080, #9932cc) !important;
            /* Violet/Mauve (Chrono) */
            color: #e2e8f0;
        }

        .leaderboard-btn {
            background: linear-gradient(135deg, #483d8b, #6a5acd) !important;
            /* Bleu fonc√©/Ardoise (Classement) */
            color: #e2e8f0;
        }

        .qcm-btn {
            background: linear-gradient(135deg, #4682b4, #5f9ea0) !important;
            /* Bleu-Vert/Acier */
            color: #e2e8f0;
        }

        .hidden {
            display: none
        }

        input {
            width: 85%;
            padding: 16px;
            margin: 12px 0;
            border: none;
            border-radius: 50px;
            font-size: 1.3rem;
            text-align: center;
            background: #1E293B;
            /* Garder un fond sombre pour le champ */
            color: #fff
        }

        .user-info {
            /* Vert fonc√©/Olive */
            background: #6B8E23;
            padding: 15px;
            border-radius: 20px;
            margin: 20px 0;
            font-size: 1.2rem
        }

        .user-info strong {
            color: #FFD700;
        }

        .stats {
            margin: 15px 0;
            color: #C0C0C0;
            /* Argent clair */
        }

        .xp-bar {
            height: 18px;
            background: #1e293b;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0
        }

        .xp-fill {
            height: 100%;
            /* Gradient Or pour l'XP */
            background: linear-gradient(90deg, #DAA520, #FFD700);
            width: 0;
            border-radius: 10px;
            transition: width 1s ease
        }

        .timer-bar {
            height: 12px;
            background: #1e293b;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0
        }

        .timer-fill {
            height: 100%;
            /* Gradient Vert/Jaune pour le chrono */
            background: linear-gradient(90deg, #388E3C, #FFD700);
            width: 100%;
            transition: width 1s linear
        }

        .timer-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #388E3C;
            margin-bottom: 10px
        }

        .answers {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 40px 20px 20px;
            flex-wrap: wrap
        }

        @media (max-width:480px) {
            .answers {
                gap: 15px;
                margin: 30px 10px 15px
            }
        }

        .ans {
            flex: 1 1 45%;
            min-width: 120px;
            max-width: 220px;
            padding: 32px 20px;
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            border-radius: 30px;
            cursor: pointer;
            transition: all .3s;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.5);
            user-select: none;
            text-align: center
        }

        .ans:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7)
        }

        .ans.disabled {
            pointer-events: none;
            opacity: .5
        }

        /* Style sp√©cifique QCM (boutons plus petits) */
        .qcm-style .ans {
            flex: 1 1 48%;
            /* Deux par ligne */
            min-width: unset;
            max-width: unset;
            padding: 20px 15px;
            /* Moins de padding */
            font-size: 1.1rem;
            text-align: left;
            white-space: normal;
            word-wrap: break-word;
        }

        @media (min-width: 500px) {
            .qcm-style .ans {
                flex: 1 1 45%;
            }
        }

        .vrai {
            background: #388E3C;
            /* Vert Vrai (Success) */
        }

        .faux {
            background: #D32F2F;
            /* Rouge Faux (Error) */
        }

        .question {
            font-size: 1.65rem;
            line-height: 1.7;
            padding: 35px 25px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 22px;
            /* Bordure Or/Vert */
            border: 2px solid #DAA52033;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 25px 20px
        }

        .result {
            font-size: 2.4rem;
            margin: 25px 0;
            font-weight: 700
        }

        .levelup {
            font-size: 1.8rem;
            /* Jaune vif pour Level Up */
            color: #FFFACD;
            text-shadow: 0 0 10px #FFD700;
            margin: 15px 0
        }

        .exp {
            margin: 25px;
            padding: 22px;
            /* Fond pour explication (Or clair avec bordure Or) */
            background: rgba(255, 215, 0, 0.15);
            border-left: 6px solid #FFD700;
            border-radius: 18px;
            font-size: 1.25rem;
            line-height: 1.7
        }

        #dailyQuizBtn.disabled {
            cursor: default;
            background: linear-gradient(135deg, #475569, #64748b) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transform: none !important
        }

        #dailyTimerDisplay {
            display: block;
            font-size: 1.1rem;
            color: #f87171;
            font-weight: 700;
            margin-top: 5px
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 1.2rem
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            border-bottom: 1px solid #1e293b
        }

        .leaderboard-table th {
            /* En-t√™te de tableau vert fonc√© */
            background: #6B8E23;
            color: #fff;
            font-size: 1.3rem
        }

        /* Couleurs podium dans le classement */
.leaderboard-table tr:nth-child(1) td {
    color: #FFD700; /* Or pour le 1ER */
    font-weight: bold;
}

.leaderboard-table tr:nth-child(2) td {
    color: #C0C0C0; /* Argent pour le 2√®me */
}

.leaderboard-table tr:nth-child(3) td {
    color: #CD7F32; /* Bronze pour le 3√®me */
}

/* Plus rien pour le 4√®me et au-del√† */
.leaderboard-table tr:nth-child(n+4) td {
    color: #e2e8f0; /* couleur normale, pas de m√©daille */
}

        .user-row {
            background: rgba(20, 60, 48, 0.96);
            /* Fond de la bo√Æte */
            border: 3px solid #FFD700;
            /* Bordure Or */
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px 30px;
            border-radius: 30px;
            /* Bordure Or Vif */
            border: 4px solid #FFD700;
            /* Ombre Or Vif */
            box-shadow: 0 0 80px #FFD700;
            z-index: 9999;
            text-align: center;
            transition: all .5s ease;
            opacity: 0;
            max-width: 90%
        }

        .popup.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1
        }

        .popup h2 {
            font-size: 3rem;
            color: #FFD700;
            margin: 20px 0
        }

        .popup .emoji {
            font-size: 5rem;
            margin: 15px 0
        }

        .popup p {
            font-size: 1.6rem;
            color: #e2e8f0;
            /* Permet un retour √† la ligne pour les listes de r√©compenses */
            white-space: pre-line;
        }

        .achievement {
            margin: 18px auto;
            padding: 18px;
            background: rgba(107, 142, 35, 0.12);
            /* Vert Olive tr√®s l√©ger */
            border-radius: 20px;
            border: 2px solid #6B8E23;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
            transition: all .4s;
            opacity: .6
        }

        .achievement.unlocked {
            /* Succ√®s d√©bloqu√© : Or */
            background: rgba(255, 215, 0, 0.25) !important;
            border: 3px solid #FFD700 !important;
            box-shadow: 0 0 30px #FFD70077;
            opacity: 1
        }

        .achievement.unlocked .emoji {
            font-size: 3rem !important
        }

        .achievement .emoji {
            font-size: 2.2rem;
            opacity: .7
        }

        /* MODIFICATION CSS: Le conteneur prend moins de largeur (max-width: 380px) */
        .daily-challenge-box {
            width: 90%;
            max-width: 380px;
            /* Vert plus clair/Or */
            background-color: #6B8E23;
            border-radius: 20px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: #fff;
            margin: 20px auto
        }

        .daily-challenge-box h2 {
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px
        }

        .daily-challenge-box p {
            font-size: 1.2rem;
            margin-bottom: 25px;
            font-weight: 500
        }

        .play-button {
            display: block;
            width: 100%;
            margin: 0 auto;
            padding: 15px 30px;
            /* Bouton JOUER Or */
            background-color: #FFD700;
            color: #143C30;
            font-size: 1.7rem;
            font-weight: bold;
            text-decoration: none;
            text-transform: uppercase;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform .2s, box-shadow .2s;
            /* Ombre fonc√©e */
            box-shadow: 0 12px 0 0 #143C30;
        }

        .play-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 0 0 #143C30
        }

        .play-button:active {
            transform: translateY(8px);
            box-shadow: 0 4px 0 0 #143C30
        }

        /* STYLE DU SHOP AJOUT√â */
        .shop-item {
            background: rgba(107, 142, 35, 0.4);
            /* Vert Olive Transparent */
            border: 2px solid #6B8E23;
            border-radius: 15px;
            padding: 18px;
            text-align: left;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px
        }

        .shop-item h3 {
            font-size: 1.7rem;
            color: #FFD700;
        }

        .shop-item .stock {
            font-size: 1.2rem;
            color: #C0C0C0;
        }

        .item-desc {
            font-size: 1.1rem;
            color: #e2e8f0;
            margin-bottom: 15px
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-footer .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .buy-btn {
            /* Utilise la classe menu-btn pour le style Or/Bronze */
            width: auto;
            padding: 12px 20px;
            font-size: 1.1rem;
            margin: 0 !important;
        }

        .buy-btn:disabled {
            background: linear-gradient(135deg, #475569, #64748b) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transform: none !important;
            cursor: default;
        }

        /* FIN STYLE SHOP */
        /* Correction visibilit√© texte boutons QCM */
        .qcm-style .ans {
            color: #ffffff !important;
            /* texte blanc forc√© */
            background: #2d5a4a !important;
            /* fond vert fonc√© lisible */
            border: 2px solid #FFD700 !important;
            /* bordure or pour contraste */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6) !important;
        }

        .qcm-style .ans:hover {
            background: #3a6f5c !important;
            /* un peu plus clair au survol */
            transform: translateY(-4px);
        }

        .qcm-style .ans:disabled {
            opacity: 0.7;
            background: #1e3a32 !important;
            /* encore plus sombre quand d√©sactiv√© */
        }

        /* Couleur quand bonne r√©ponse (vert) et mauvaise (rouge) */
        .qcm-style .ans[style*="background-color: #388E3C"],
        .qcm-style .ans[style*="background-color: rgb(56, 142, 60)"] {
            color: #ffffff !important;
        }

        .qcm-style .ans[style*="background-color: #D32F2F"],
        .qcm-style .ans[style*="background-color: rgb(211, 47, 47)"] {
            color: #ffffff !important;
        }
    </style>
</head>

<body>
    <audio id="good" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-205.mp3"></audio>
    <audio id="bad" src="https://assets.mixkit.co/sfx/preview/mixkit-negative-interface-beep-203.mp3"></audio>
    <audio id="timeout" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-bass-548.mp3"></audio>
    <audio id="levelup" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>
    <audio id="unlock" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
    <div class="box">
        <div id="auth" class="">
            <h1>Quiz Islam</h1>
            <p style="font-size:1.5rem;margin:25px 0;">Cr√©e un compte ou connecte-toi</p>
            <input type="text" id="pseudo" placeholder="Pseudo">
            <input type="password" id="password" placeholder="Mot de passe">
            <button class="menu-btn" onclick="login()">Se connecter</button>
            <button class="menu-btn settings-btn" onclick="register()">Cr√©er un compte</button>
        </div>
        <div id="menu" class="hidden">
            <h1>Quiz Islam</h1>
            <div id="ramadanCountdown">
                Event du ramadan 2026 dans...
                <span id="countdownTimer">Calcul en cours...</span>
            </div>
        <!-- Bouton qui ouvre le calendrier cadeau -->
<!-- Bouton coll√© tout √† gauche, sans marge inutile -->
<div style="width:100%; padding: 0; margin: 12px 0 20px; text-align: left;">
    <button id="ramadanGiftBtn" class="menu-btn" style="
        margin: 0 0 0 12px;           /* juste un petit d√©calage √† gauche pour ne pas √™tre coll√© au bord absolu */
        width: auto;                  /* plus large que 240px si besoin */
        min-width: 100px;
        padding: 14px 10px;
        font-size: 1.55rem;
        background: linear-gradient(135deg, #FFDD57, #FFAA00);
        border: 2px solid #D4A017;
        box-shadow: 0 7px 22px rgba(255, 215, 0, 0.55);
        border-radius: 60px;
    ">
        üéÅ Calendrier Cadeaux Ramadan
    </button>
</div>

<!-- Popup Calendrier Interactif -->
<div class="popup" id="ramadanGiftPopup" style="max-width:460px; padding:25px 20px; overflow-y:auto; max-height:85vh;">
    <div class="emoji" style="font-size:5rem;">üéÅüìÖüåô</div>
    <h2 style="color:#FFD700; margin:15px 0 5px;">Calendrier Cadeaux Pr√©-Ramadan 2026</h2>
    <p id="giftDaysLeft" style="font-size:1.4rem; font-weight:bold; margin-bottom:20px;"></p>

    <!-- Grille calendrier responsive -->
    <div id="ramadanCalendarGrid" style="
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin: 20px 0 30px;
        font-size: 1.1rem;
        text-align: center;
    "></div>

    <p id="selectedDayReward" style="font-size:1.3rem; line-height:1.5; white-space:pre-line; margin:20px 0; min-height:80px;"></p>

    <button id="claimSelectedDayBtn" class="menu-btn success-btn" style="width:100%; padding:18px; font-size:1.4rem;" disabled>
        Claim ce jour
    </button>

    <button class="menu-btn settings-btn" onclick="document.getElementById('ramadanGiftPopup').classList.remove('show')" style="margin-top:15px; width:100%;">
        Fermer
    </button>
</div>
            <div class="user-info">
                Bienvenue <strong id="username"></strong> ‚Ä¢ Niveau <strong id="levelNum">1</strong>
                <br>üí∞ Points : <strong id="userPoints">0</strong>
            </div>
            <div class="stats">Streak : <span id="streak">0</span> | Record Infini : <span id="best">0</span></div>
            <div class="xp-bar">
                <div class="xp-fill" id="xpFill"></div>
            </div>
            <div style="margin:15px 0;color:#94a3b8;">XP: <span id="xp">0</span>/<span id="xpMax">100</span></div>

            <div class="daily-challenge-box" id="dailyQuizBtnContainer">
                <h2>D√âFI DU JOUR</h2>
                <p>5 questions &rarr; **+200 XP si 5/5**</p>
                <button class="play-button" id="dailyQuizBtn" onclick="checkDailyQuizAvailability()">JOUER</button>
                <span id="dailyTimerDisplay" style="display:none;font-size:1.1rem;color:#f87171;font-weight:700;margin-top:15px;display:block;"></span>
            </div>

            <button class="menu-btn leaderboard-btn" onclick="showShop()">üõçÔ∏è Shop Quotidien</button>
            <button class="menu-btn" onclick="showDifficultyMenu()">Mode Classique (Difficult√©)</button>
            <button class="menu-btn qcm-btn" onclick="startQCM()">Mode QCM (10 Q. - 4 Choix)</button>
            <button class="menu-btn chrono-btn" onclick="startChrono()">Mode Chrono (10 Q. - 10s)</button>
            <button class="menu-btn infinite-btn" onclick="startInfinite()">Mode Infini (1 Faute = Perdu)</button>
            <button class="menu-btn leaderboard-btn" onclick="showLeaderboard()">Classement</button>
            <button class="menu-btn success-btn" onclick="showAchievements()">Succ√®s</button>
            <button class="menu-btn settings-btn" onclick="showSettings()">Param√®tres</button>
        </div>
        <!-- Popup Cadeau Ramadan -->
<div class="popup" id="ramadanGiftPopup" style="max-width:420px; padding:25px 20px;">
    <div class="emoji" style="font-size:5.5rem;">üéÅüåô</div>
    <h2 style="color:#FFD700; margin:15px 0;">Pr√©paration Ramadan 2026</h2>
    
    <p id="giftDaysLeft" style="font-size:1.5rem; font-weight:bold; margin-bottom:18px;"></p>
    
    <!-- Mini calendrier -->
    <div id="ramadanMiniCalendar" style="
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin: 20px 0 30px;
        font-size: 1.15rem;
        text-align: center;
    "></div>
    
    <p id="giftRewardText" style="font-size:1.35rem; line-height:1.6; white-space:pre-line; margin-bottom:25px;"></p>
    
    <button id="claimRamadanGiftBtn" class="menu-btn success-btn" style="width:100%; padding:18px; font-size:1.5rem;">
        Claim la r√©compense
    </button>
    
    <button class="menu-btn settings-btn" onclick="document.getElementById('ramadanGiftPopup').classList.remove('show')" style="margin-top:15px; width:100%;">
        Fermer
    </button>
</div>

        <div id="shop" class="hidden">
            <h1>üõçÔ∏è Shop Quotidien</h1>
            <p style="font-size:1.4rem;margin-bottom:20px;color:#FFD700;">Les offres changent tous les jours !</p>

            <div id="shopChrono" style="font-size: 1.3rem; font-weight: bold; color: #f87171; margin-bottom: 20px;"></div>
            <div id="shopItemsContainer" style="display:flex;flex-direction:column;gap:20px;">
            </div>
            <h2 style="margin-top:40px;margin-bottom:15px;color:#6B8E23;">Inventaire</h2>
            <ul id="ownedItemsList" style="list-style:none;text-align:left;padding:0 20px;font-size:1.3rem;">
            </ul>

            <button class="menu-btn settings-btn" onclick="showMenu()">Retour au menu</button>
        </div>
        <div id="leaderboard" class="hidden">
    <h1>Classement</h1>
    <table class="leaderboard-table" id="leaderboardTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Joueur</th>
                <th style="position: relative; padding: 0;">
                    <div id="currentCategoryBtn" style="
                        cursor: pointer;
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: #6B8E23;
                        color: #fff;
                        font-size: 1.3rem;
                        font-weight: bold;
                        padding: 12px;
                    ">
                        Total XP ‚ñº
                    </div>

                    <div id="categoryList" style="
                        display: none;
                        position: absolute;
                        top: 100%;
                        left: 0;
                        right: 0;
                        background: rgba(20, 60, 48, 0.98);
                        border: 2px solid #6B8E23;
                        border-top: none;
                        border-radius: 0 0 12px 12px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.5);
                        z-index: 10;
                    ">
                        <div onclick="selectCategory('totalXp')" style="cursor:pointer;padding:12px;font-size:1.25rem;color:#e2e8f0;border-bottom:1px solid #6B8E2344;background:#6B8E23;">Total XP</div>
                        <div onclick="selectCategory('infiniteBest')" style="cursor:pointer;padding:12px;font-size:1.25rem;color:#e2e8f0;border-bottom:1px solid #6B8E2344;background:#6B8E23;">Meilleur Mode Infini</div>
                        <div onclick="selectCategory('points')" style="cursor:pointer;padding:12px;font-size:1.25rem;color:#e2e8f0;background:#6B8E23;">Points Boutique</div>
                    </div>
                </th>
            </tr>
        </thead>
        <tbody id="leaderboardBody"></tbody>
    </table>
    <button class="menu-btn" onclick="showMenu()">Retour</button>
</div>
        <div id="achievements" class="hidden">
            <h1>Succ√®s</h1>
            <div class="achievement" id="a1"><span class="emoji">üë∂</span>
                <div><strong>Premier pas</strong><br><span id="a1-prog"></span></div>
            </div>
            <div class="achievement" id="a2"><span class="emoji">üíØ</span>
                <div><strong>10/10 Parfait !</strong><br><span id="a2-prog"></span></div>
            </div>
            <div class="achievement" id="a3"><span class="emoji">üî•</span>
                <div><strong>Streak de feu</strong><br><span id="a3-prog"></span></div>
            </div>
            <div class="achievement" id="a4"><span class="emoji">‚ôæÔ∏è</span>
                <div><strong>Infini 50</strong><br><span id="a4-prog"></span></div>
            </div>
            <div class="achievement" id="a5"><span class="emoji">‚è±Ô∏è</span>
                <div><strong>Vitesse √âclair</strong><br><span id="a5-prog"></span></div>
            </div>
            <div class="achievement" id="a6"><span class="emoji">‚≠ê</span>
                <div><strong>1000 XP</strong><br><span id="a6-prog"></span></div>
            </div>
            <div class="achievement" id="a7"><span class="emoji">üìö</span>
                <div><strong>Savant en devenir</strong><br><span id="a7-prog"></span></div>
            </div>
            <div class="achievement" id="a8"><span class="emoji">üèÜ</span>
                <div><strong>Ma√Ætre du Vrai/Faux</strong><br><span id="a8-prog"></span></div>
            </div>
            <div class="achievement" id="a9"><span class="emoji">üìø</span>
                <div><strong>Hafiz</strong><br><span id="a9-prog"></span></div>
            </div>
            <div class="achievement" id="a11"><span class="emoji">üß†</span>
                <div><strong>QCM Initi√©</strong><br><span id="a11-prog"></span></div>
            </div>
            <div class="achievement" id="a12"><span class="emoji">‚úÖ</span>
                <div><strong>Ma√Ætre QCM</strong><br><span id="a12-prog"></span></div>
            </div>
            <div class="achievement" id="a10"><span class="emoji">üíé</span>
                <div><strong>L√©gende de la oumma</strong><br><span id="a10-prog"></span></div>
            </div>

            <!-- === AJOUT DES NOUVEAUX SUCC√àS DEMAND√âS === -->
            <div class="achievement" id="a13"><span class="emoji">‚è±Ô∏è</span>
                <div><strong>Chrono Passionn√©</strong><br><span id="a13-prog"></span></div>
            </div>
            <div class="achievement" id="a14"><span class="emoji">‚ö°</span>
                <div><strong>Ma√Ætre Chrono</strong><br><span id="a14-prog"></span></div>
            </div>
            <div class="achievement" id="a15"><span class="emoji">‚ôæÔ∏è</span>
                <div><strong>Survivant 25</strong><br><span id="a15-prog"></span></div>
            </div>
            <div class="achievement" id="a16"><span class="emoji">üéØ</span>
                <div><strong>Expert QCM</strong><br><span id="a16-prog"></span></div>
            </div>
            <div class="achievement" id="a17"><span class="emoji">üõçÔ∏è</span>
                <div><strong>Collectionneur Boutique</strong><br><span id="a17-prog"></span></div>
            </div>
            <div class="achievement" id="a18"><span class="emoji">üí∏</span>
                <div><strong>Grand D√©pensier</strong><br><span id="a18-prog"></span></div>
            </div>
            <div class="achievement" id="a19"><span class="emoji">üí∞</span>
                <div><strong>Millionnaire Boutique</strong><br><span id="a19-prog"></span></div>
            </div>
            <div class="achievement" id="a20"><span class="emoji">üèÖ</span>
                <div><strong>Parfait dans tous les niveaux</strong><br><span id="a20-prog"></span></div>
            </div>
            <div class="achievement" id="a21"><span class="emoji">ü•â</span>
                <div><strong>Le Podium</strong><br><span id="a21-prog"></span></div>
            </div>
            <div class="achievement" id="a22"><span class="emoji">ü•á</span>
                <div><strong>Num√©ro 1 Mondial</strong><br><span id="a22-prog"></span></div>
            </div>
            <div class="achievement" id="a23"><span class="emoji">üìÖ</span>
                <div><strong>Assidu Quotidien</strong><br><span id="a23-prog"></span></div>
            </div>
            <div class="achievement" id="a24"><span class="emoji">üî•</span>
                <div><strong>Triple D√©fi</strong><br><span id="a24-prog"></span></div>
            </div>
            <div class="achievement" id="a25"><span class="emoji">üîÑ</span>
                <div><strong>Stock de Rerolls</strong><br><span id="a25-prog"></span></div>
            </div>

            <button class="menu-btn" onclick="showMenu()">Retour</button>
        </div>
        <div id="settings" class="hidden">
            <h1>Param√®tres</h1>
            <div class="user-info">Connect√© : <strong id="username2"></strong><br>Niveau <strong id="levelNum2">1</strong> ‚Ä¢ XP total : <strong id="totalXp">0</strong></div>
            <button class="menu-btn infinite-btn" onclick="useDailyReroll()">Utiliser Daily Reroll (Poss√©d√© : <span id="rerollCount">0</span>)</button>
            <button class="menu-btn" onclick="showMenu()">Retour au menu</button>
            <button class="menu-btn danger-btn" onclick="resetAccount()">R√©initialiser mon compte</button>
            <button class="menu-btn settings-btn" onclick="logout()">D√©connexion</button>
        </div>
        <div id="difficultyMenu" class="hidden">
            <h1>Choix de la Difficult√©</h1>
            <p style="font-size:1.4rem;margin-bottom:25px;color:#94a3b8;">10 questions par partie. Gagnez des **points** en r√©pondant correctement.</p>
            <button class="menu-btn" onclick="startClassic(1)">Facile (1 XP/Q)</button>
            <button class="menu-btn chrono-btn" onclick="startClassic(2)">Normal (10 XP/Q)</button>
            <button class="menu-btn infinite-btn" onclick="startClassic(3)">Difficile (15 XP/Q)</button>
            <button class="menu-btn settings-btn" onclick="showMenu()">Retour au menu</button>
        </div>
        <div id="game" class="hidden">
            <h1 id="gameTitle">Quiz Islam</h1>
            <div class="stats" id="gameProgress"></div>
            <div id="timerContainer" class="hidden">
                <div class="timer-text" id="timerText"></div>
                <div class="timer-bar">
                    <div class="timer-fill" id="timerFill"></div>
                </div>
            </div>
            <div class="question" id="q">Pr√™t ?</div>

            <div class="answers" id="answers">
            </div>
            <div class="result" id="result"></div>
            <div class="levelup hidden" id="levelUp">NIVEAU UP !</div>
            <div class="exp" id="exp"></div>
            <button class="menu-btn chrono-btn" id="hintBtn" onclick="useHint()" style="width:50%;margin-top:10px;">Utiliser Indice (<span id="hintCount">0</span>)</button>

            <button class="menu-btn hidden" id="nextBtn" onclick="nextQuestion()">Question Suivante</button>
            <button class="menu-btn hidden" id="restartBtn" onclick="showMenu()">Retour au menu principal</button>
        </div>
    <!-- FOOTER FIXE EN BAS DE TOUTES LES PAGES -->
<div style="margin-top: 40px; padding: 20px 0; text-align: center; font-size: 1.1rem; color: #94a3b8; border-top: 1px solid #6B8E2340;">
    <p style="margin-bottom: 15px;">LIEN CLIQUABLEüåô</p>
    
    <a href="https://github.com/m2sltco-ux/islam-quiz/wiki/Accueil" target="_blank" style="color: #1a0dab; text-decoration: underline; margin: 0 15px; cursor: pointer;">
        üìñ Lire le Wiki
    </a>
    
    <a href="https://github.com/m2sltco-ux/islam-quiz/discussions/1" target="_blank" style="color: #1a0dab; text-decoration: underline; margin: 0 15px; cursor: pointer;">
        Bugs / Questions / Suggestions
    </a>
</div>
    <div class="popup" id="popup">
        <div class="emoji" id="popupEmoji">üèÜ</div>
        <h2 id="popupTitle">Succ√®s d√©bloqu√© !</h2>
        <p id="popupText">MashaAllah akhi !</p>
    </div>

    <script>
        const questions = [{
                q: "La sourate la plus courte du Coran est Al-Kawthar.",
                a: true,
                e: "Elle ne comporte que 3 versets.",
                diff: 1
            },
            {
                q: "Le Proph√®te Muhammad Ô∑∫ a eu 4 filles.",
                a: true,
                e: "Zaynab, Ruqayya, Umm Kulthum et Fatima.",
                diff: 1
            },
            {
                q: "La pri√®re de Tarawih se fait uniquement pendant le mois de Ramadan.",
                a: true,
                e: "Elle est sp√©cifique au Ramadan.",
                diff: 1
            },
            {
                q: "Le hijab est obligatoire pour les hommes en Islam.",
                a: false,
                e: "Il concerne les femmes ; les hommes doivent s'habiller modestement.",
                diff: 1
            },
            {
                q: "La premi√®re r√©v√©lation a √©t√© re√ßue dans la grotte de Hira.",
                a: true,
                e: "C'est l√† que l'ange Jibril est venu avec 'Iqra'.",
                diff: 1
            },
            {
                q: "Le mois de Muharram est le premier mois du calendrier islamique.",
                a: true,
                e: "Il marque le d√©but de l'ann√©e h√©girienne.",
                diff: 1
            },
            {
                q: "Il est permis de manger du porc s'il est bien cuit.",
                a: false,
                e: "Le porc reste interdit en toute circonstance.",
                diff: 1
            },
            {
                q: "La sourate Al-Ikhlas parle de l'unicit√© d'Allah.",
                a: true,
                e: "Elle est appel√©e 'l'√©quivalent du tiers du Coran'.",
                diff: 1
            },
            {
                q: "Le Proph√®te Ô∑∫ est mort √† l‚Äô√¢ge de 63 ans.",
                a: true,
                e: "En l'an 11 de l'H√©gire, √† M√©dine.",
                diff: 1
            },
            {
                q: "La pri√®re du vendredi (Jumu'a) remplace la pri√®re du Dhuhr.",
                a: true,
                e: "Elle compte pour le Dhuhr du vendredi.",
                diff: 1
            },
            // Nouvelles questions - Niveau 2 (moyen - diff:2)
            {
                q: "La sourate Al-Baqara est la seule √† mentionner directement le je√ªne du Ramadan.",
                a: true,
                e: "Versets 183-185 qui instituent le je√ªne.",
                diff: 2
            },
            {
                q: "Il est obligatoire de r√©citer la Fatiha dans chaque rakat des pri√®res obligatoires.",
                a: true,
                e: "Selon la majorit√© des √©coles (madhahib).",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ n‚Äôa accompli le Hajj qu‚Äôune seule fois dans sa vie.",
                a: true,
                e: "Hajj al-Wadaa (le Hajj d‚Äôadieu).",
                diff: 2
            },
            {
                q: "La zakat al-fitr doit id√©alement √™tre donn√©e avant la pri√®re de l‚ÄôA√Ød.",
                a: true,
                e: "C‚Äôest la r√®gle recommand√©e.",
                diff: 2
            },
            {
                q: "L‚Äôange Israfil est celui qui sonnera dans la trompette le Jour du Jugement.",
                a: true,
                e: "Il est charg√© du Souffle (Nafkha).",
                diff: 2
            },
            {
                q: "Il est recommand√© de je√ªner le jour de ‚ÄòArafat m√™me quand on fait le Hajj.",
                a: false,
                e: "D√©conseill√© pour les p√®lerins ; recommand√© pour les autres.",
                diff: 2
            },
            {
                q: "La sourate Maryam est la seule sourate nomm√©e d‚Äôapr√®s une femme.",
                a: true,
                e: "Maryam (Marie) est la seule femme √† avoir une sourate √† son nom.",
                diff: 2
            },
            {
                q: "La pri√®re de l‚Äôistikhara est r√©serv√©e uniquement aux questions de mariage.",
                a: false,
                e: "Elle est recommand√©e pour toute d√©cision importante.",
                diff: 2
            },
            {
                q: "Il existe exactement 99 noms d‚ÄôAllah mentionn√©s dans le Coran et la Sunna.",
                a: true,
                e: "C‚Äôest le nombre traditionnel rapport√©.",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ a dit que le je√ªne du jour de ‚ÄòAchoura efface les p√©ch√©s d‚Äôune ann√©e enti√®re.",
                a: false,
                e: "C‚Äôest le je√ªne de ‚ÄòAchoura + un jour avant ou apr√®s qui efface une ann√©e de p√©ch√©s mineurs.",
                diff: 2
            },
            // Nouvelles questions - Niveau 3 (avanc√© - diff:3)
            {
                q: "La meilleure action apr√®s les obligations est le jihad dans le sentier d‚ÄôAllah selon un hadith authentique.",
                a: false,
                e: "Selon Bukhari/Muslim, c‚Äôest la Hajj mabrur qui vient en second.",
                diff: 3
            },
            {
                q: "La sourate Al-Masad (Al-Lahab) est la seule √† mentionner Abou Lahab par son nom.",
                a: true,
                e: "Elle le cite explicitement.",
                diff: 3
            },
            {
                q: "Il est permis de faire le tawaf al-ifada avant le jour du sacrifice si on est press√©.",
                a: true,
                e: "Avis majoritaire : possible, mais tawaf al-wada‚Äô reste obligatoire apr√®s.",
                diff: 3
            },
            {
                q: "Le hadith ¬´ Les actions ne valent que par les intentions ¬ª est rapport√© par Boukhari et Muslim.",
                a: true,
                e: "C‚Äôest le premier hadith de Sahih al-Bukhari.",
                diff: 3
            },
            {
                q: "La sourate An-Nisa contient le plus grand nombre de versets sur les r√®gles d‚Äôh√©ritage.",
                a: true,
                e: "Versets 11, 12, 176 notamment.",
                diff: 3
            },
            {
                q: "Il est obligatoire de r√©citer une sourate apr√®s la Fatiha dans les deux premi√®res rakats du Fajr, Maghrib et Isha.",
                a: true,
                e: "Sunnah mu‚Äôakkada selon la majorit√©.",
                diff: 3
            },
            {
                q: "Le Proph√®te Ô∑∫ a interdit de je√ªner uniquement le vendredi sans le combiner avec un autre jour.",
                a: true,
                e: "Hadith authentique (sauf si c‚Äôest une habitude continue).",
                diff: 3
            },
            {
                q: "Selon l‚Äôavis majoritaire des savants, la femme en p√©riode de r√®gles peut toucher le Mushaf.",
                a: false,
                e: "La majorit√© l‚Äôinterdit ; certains contemporains le permettent avec pr√©caution.",
                diff: 3
            },
            {
                q: "L‚Äôhistoire du mouton qui parle (le berger et le loup) est un hadith authentique.",
                a: false,
                e: "C‚Äôest consid√©r√© comme faible ou fabriqu√© par la majorit√© des muhaddithun.",
                diff: 3
            },
            {
                q: "Lire la sourate Al-Kahf le vendredi prot√®ge de la fitna du Dajjal selon un hadith authentique.",
                a: true,
                e: "Rapport√© par Muslim : protection entre deux vendredis.",
                diff: 3
            },
            {
                q: "Le Coran a √©t√© r√©v√©l√© sur 23 ans.",
                a: true,
                e: "13 ans √† La Mecque + 10 ans √† M√©dine",
                diff: 1
            },
            {
                q: "Il y a 5 piliers de l‚Äôislam.",
                a: true,
                e: "Chahada, pri√®re, zakat, je√ªne, hajj",
                diff: 1
            },
            {
                q: "La pri√®re du Fajr a 4 rakats.",
                a: false,
                e: "Seulement 2 rakats",
                diff: 1
            },
            {
                q: "Le Proph√®te est n√© √† La Mecque.",
                a: true,
                e: "Ann√©e de l‚Äô√©l√©phant",
                diff: 1
            },
            {
                q: "Le Coran a 114 sourates.",
                a: true,
                e: "86 mecquoises, 28 m√©dinoises",
                diff: 1
            },
            {
                q: "La zakat est de 2,5 %.",
                a: true,
                e: "Sur l‚Äô√©pargne gard√©e 1 an",
                diff: 1
            },
            {
                q: "Le Paradis est sous les pieds des m√®res.",
                a: true,
                e: "Hadith authentique",
                diff: 1
            },
            {
                q: "Le je√ªne du Ramadan est obligatoire pour les enfants.",
                a: false,
                e: "Seulement √† partir de la pubert√©",
                diff: 1
            },
            {
                q: "Le nom du Proph√®te est Muhammad (Ô∑∫).",
                a: true,
                e: "Le sceau des Proph√®tes.",
                diff: 1
            },
            {
                q: "Allah a cr√©√© l'univers en 6 jours.",
                a: true,
                e: "En 6 jours, selon le Coran.",
                diff: 1
            },
            {
                q: "Le premier calife de l'Islam fut Omar Ibn al-Khattab.",
                a: false,
                e: "C'√©tait Abou Bakr As-Siddiq.",
                diff: 1
            },
            {
                q: "Le terme 'Hadith' d√©signe les paroles, actions et approbations du Proph√®te Muhammad (Ô∑∫).",
                a: true,
                e: "Il est la deuxi√®me source de l√©gislation apr√®s le Coran.",
                diff: 1
            },
            {
                q: "La pri√®re obligatoire est effectu√©e cinq fois par jour.",
                a: true,
                e: "Fajr, Dhuhr, Asr, Maghrib, Isha.",
                diff: 1
            },
            {
                q: "Le Proph√®te Muhammad (Ô∑∫) est enterr√© √† La Mecque.",
                a: false,
                e: "Il est enterr√© √† M√©dine (Masjid an-Nabawi).",
                diff: 1
            },
            {
                q: "La Kaaba se trouve dans la ville de J√©rusalem.",
                a: false,
                e: "Elle se trouve dans la ville sainte de La Mecque.",
                diff: 1
            },
            {
                q: "Il y a 6 piliers de la foi.",
                a: true,
                e: "Allah, anges, livres, proph√®tes, Jour dernier, destin",
                diff: 2
            },
            {
                q: "La pri√®re du vendredi fait 2 rakats en public.",
                a: true,
                e: "Remplace le zuhr",
                diff: 2
            },
            {
                q: "Le Hajj peut se faire toute l‚Äôann√©e.",
                a: false,
                e: "Uniquement en Dhul-Hijja",
                diff: 2
            },
            {
                q: "Laylat al-Qadr vaut mieux que 1000 mois.",
                a: true,
                e: "Sourate Al-Qadr",
                diff: 2
            },
            {
                q: "Le je√ªne de Ramadan est obligatoire sans exception.",
                a: false,
                e: "Enfants, malades, voyageurs exempt√©s",
                diff: 2
            },
            {
                q: "Le Proph√®te √©tait illettr√© (ummi).",
                a: true,
                e: "Preuve du miracle",
                diff: 2
            },
            {
                q: "Le porc devient halal si on dit bismillah.",
                a: false,
                e: "Toujours interdit",
                diff: 2
            },
            {
                q: "Le sacrifice de l‚ÄôA√Ød al-Adha comm√©more Ibrahim.",
                a: true,
                e: "Pr√™t √† sacrifier son fils",
                diff: 2
            },
            {
                q: "La direction de la pri√®re (Qibla) a toujours √©t√© La Mecque.",
                a: false,
                e: "Au d√©but, c'√©tait J√©rusalem.",
                diff: 2
            },
            {
                q: "La sourate Al-Fatiha est appel√©e 'La m√®re du Livre'.",
                a: true,
                e: "Oum al-Kitab.",
                diff: 2
            },
            {
                q: "L'aum√¥ne l√©gale (Zakat) est due sur l'or et l'argent d√®s qu'elle atteint le seuil du Nissab.",
                a: true,
                e: "Le Nissab est la quantit√© minimale qui rend la Zakat obligatoire.",
                diff: 2
            },
            {
                q: "Il est permis de rompre son je√ªne en voyage, m√™me si l'on ne ressent aucune difficult√©.",
                a: true,
                e: "La rupture est permise, mais le rattrapage est obligatoire.",
                diff: 2
            },
            {
                q: "Le Tawaf (circumambulation autour de la Kaaba) se compose de 5 tours.",
                a: false,
                e: "Le Tawaf comporte 7 tours.",
                diff: 2
            },
            {
                q: "Le terme 'Sunna' fait exclusivement r√©f√©rence aux actions du Proph√®te (Ô∑∫).",
                a: false,
                e: "Il englobe aussi ses paroles, approbations et caract√©ristiques.",
                diff: 2
            },
            {
                q: "La plus longue sourate du Coran est Al-Baqara.",
                a: true,
                e: "Elle contient 286 versets.",
                diff: 2
            },
            {
                q: "L'ange Gabriel (Jibril) est l'ange de la mort.",
                a: false,
                e: "C'est l'ange Azra√´l (Malak al-Mawt). Jibril est l'ange de la r√©v√©lation.",
                diff: 3
            },
            {
                q: "Le mois de Rajab fait partie des mois sacr√©s de l'Islam.",
                a: true,
                e: "Ce sont : Dhul-Qa'dah, Dhul-Hijjah, Muharram et Rajab.",
                diff: 3
            },
            {
                q: "Witr est une pri√®re sur√©rogatoire (nafila) qui doit se faire √† 3 rakats.",
                a: false,
                e: "Elle peut √™tre faite avec 1, 3, 5, 7 ou 9 rakats.",
                diff: 3
            },
            {
                q: "Le livre de l'imam Al-Bukhari est le 'Sahih Muslim'.",
                a: false,
                e: "C'est le 'Sahih Al-Bukhari'.",
                diff: 3
            },
            {
                q: "La Mecque est la premi√®re Qibla de l'Islam.",
                a: false,
                e: "C'√©tait J√©rusalem (Bayt al-Maqdis) pendant une p√©riode.",
                diff: 3
            },
            {
                q: "Le nom 'Al-Firdaws' fait r√©f√©rence au niveau le plus √©lev√© de l'Enfer.",
                a: false,
                e: "Al-Firdaws est le niveau le plus √©lev√© du Paradis.",
                diff: 3
            },
            {
                q: "Le je√ªne de 'Achoura' est recommand√© le 9√®me jour du mois de Muharram.",
                a: false,
                e: "Il est recommand√© de je√ªner le 9√®me et le 10√®me jours pour se distinguer des Juifs.",
                diff: 3
            },
            {
                q: "Le Masjid Al-Aqsa, situ√© √† J√©rusalem, est la deuxi√®me mosqu√©e construite sur Terre apr√®s la Kaaba.",
                a: false,
                e: "C'est la troisi√®me. La deuxi√®me est la Mosqu√©e du Proph√®te √† M√©dine.",
                diff: 3
            },
            {
                q: "Un 'Muharram' (personne illicite au mariage) est une personne avec qui le mariage est l√©galement interdit de fa√ßon permanente.",
                a: true,
                e: "S≈ìur, m√®re, tante, etc.",
                diff: 3
            },
            {
                q: "L'expression 'InchaAllah' signifie 'Si Dieu veut' et ne doit √™tre utilis√©e que pour les √©v√©nements futurs.",
                a: true,
                e: "Son usage pour le pass√© ou le pr√©sent est incorrect.",
                diff: 3
            },
            // === Nouvelles questions - Niveau 1 (facile - diff:1) - 20 questions ===
            {
                q: "La sourate Al-Fatiha est la premi√®re sourate du Coran.",
                a: true,
                e: "Elle ouvre le Coran et est appel√©e Umm al-Kitab.",
                diff: 1
            },
            {
                q: "Le mois de Ramadan dure toujours 29 ou 30 jours.",
                a: true,
                e: "Selon l'observation de la lune.",
                diff: 1
            },
            {
                q: "Il y a 7 cieux selon le Coran.",
                a: true,
                e: "Mentionn√© dans plusieurs sourates.",
                diff: 1
            },
            {
                q: "La pri√®re de l'A√Ød se fait apr√®s le lever du soleil.",
                a: true,
                e: "Environ 15-20 minutes apr√®s le lever.",
                diff: 1
            },
            {
                q: "Le Proph√®te Ô∑∫ a re√ßu la r√©v√©lation √† l'√¢ge de 40 ans.",
                a: true,
                e: "√Ä la grotte de Hira.",
                diff: 1
            },
            {
                q: "La zakat est obligatoire sur l'or √† partir de 85 g.",
                a: true,
                e: "C'est le nisab pour l'or.",
                diff: 1
            },
            {
                q: "Il est interdit de prier pendant le lever du soleil.",
                a: true,
                e: "Moment makruh (d√©conseill√©).",
                diff: 1
            },
            {
                q: "La sourate Yasin est appel√©e le c≈ìur du Coran.",
                a: true,
                e: "Hadith rapport√© par Tirmidhi.",
                diff: 1
            },
            {
                q: "Le je√ªne commence √† l'aube (fajr) et se termine au coucher du soleil.",
                a: true,
                e: "D√©but et fin du je√ªne.",
                diff: 1
            },
            {
                q: "Abou Bakr As-Siddiq fut le premier calife.",
                a: true,
                e: "Apr√®s le d√©c√®s du Proph√®te Ô∑∫.",
                diff: 1
            },
            {
                q: "La pri√®re du Witr est obligatoire.",
                a: false,
                e: "Elle est sunnah mu'akkada (fortement recommand√©e).",
                diff: 1
            },
            {
                q: "Le Coran a √©t√© compil√© sous le califat d'Abou Bakr.",
                a: true,
                e: "Par Zayd ibn Thabit.",
                diff: 1
            },
            {
                q: "Il est permis de manger avant l'aube pendant le je√ªne.",
                a: true,
                e: "C'est le suhur, recommand√©.",
                diff: 1
            },
            {
                q: "La Kaaba a √©t√© construite par Ibrahim et Isma√Øl.",
                a: true,
                e: "Selon le Coran (sourate Al-Baqara 127).",
                diff: 1
            },
            {
                q: "Il y a 8 portes au Paradis.",
                a: true,
                e: "Selon plusieurs hadiths.",
                diff: 1
            },
            {
                q: "La sourate Al-Kawthar promet une abondance au Proph√®te Ô∑∫.",
                a: true,
                e: "Elle est tr√®s courte mais puissante.",
                diff: 1
            },
            {
                q: "Le Proph√®te Ô∑∫ a enseign√© la pri√®re aux compagnons.",
                a: true,
                e: "Il est notre mod√®le en tout.",
                diff: 1
            },
            {
                q: "La chahada est le premier pilier de l'islam.",
                a: true,
                e: "T√©moignage de foi.",
                diff: 1
            },
            {
                q: "Il est interdit de couper les ongles pendant le Hajj avant le sacrifice.",
                a: false,
                e: "Interdit pour celui qui est en ihram avant le sacrifice.",
                diff: 1
            },
            {
                q: "Le jour de l'A√Ød al-Fitr marque la fin du Ramadan.",
                a: true,
                e: "F√™te de la rupture du je√ªne.",
                diff: 1
            },
            // === Nouvelles questions - Niveau 2 (moyen - diff:2) - 20 questions ===
            {
                q: "La sourate Al-Mulk prot√®ge du ch√¢timent de la tombe.",
                a: true,
                e: "Hadith authentique rapport√© par Tirmidhi.",
                diff: 2
            },
            {
                q: "Il est recommand√© de je√ªner les 6 jours de Shawwal apr√®s Ramadan.",
                a: true,
                e: "√âquivaut √† je√ªner toute l'ann√©e.",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ a fait deux hijras : une vers l'Abyssinie et une vers M√©dine.",
                a: true,
                e: "Hijra vers Habasha puis Hijra vers M√©dine.",
                diff: 2
            },
            {
                q: "La pri√®re du tahajjud se fait apr√®s minuit.",
                a: true,
                e: "Pri√®res de nuit tr√®s recommand√©es.",
                diff: 2
            },
            {
                q: "La zakat est due sur les bijoux en or port√©s par les femmes.",
                a: false,
                e: "Si c'est pour usage personnel, pas de zakat selon majorit√©.",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ a dit que la meilleure des charit√©s est celle donn√©e en secret.",
                a: true,
                e: "Hadith authentique.",
                diff: 2
            },
            {
                q: "La sourate Al-Fatiha doit √™tre r√©cit√©e dans chaque rakat de pri√®re.",
                a: true,
                e: "Obligatoire selon la majorit√© des √©coles.",
                diff: 2
            },
            {
                q: "Le jour de ‚ÄòArafat est le 9√®me jour de Dhul-Hijja.",
                a: true,
                e: "Jour le plus important du Hajj.",
                diff: 2
            },
            {
                q: "Il est permis de faire le tawaf en courant pour les hommes lors du premier tawaf.",
                a: true,
                e: "C'est le ramal (sunnah).",
                diff: 2
            },
            {
                q: "La sourate Ad-Duha a √©t√© r√©v√©l√©e pour r√©conforter le Proph√®te Ô∑∫.",
                a: true,
                e: "Apr√®s une pause dans la r√©v√©lation.",
                diff: 2
            },
            {
                q: "Le je√ªne du jour de ‚ÄòAchoura est obligatoire.",
                a: false,
                e: "Il est fortement recommand√©.",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ a eu 11 √©pouses au total.",
                a: true,
                e: "Dont Khadija et A√Øcha.",
                diff: 2
            },
            {
                q: "La pri√®re du Dhuhr se fait √† 4 rakats.",
                a: true,
                e: "Obligatoire.",
                diff: 2
            },
            {
                q: "Il est interdit de r√©citer le Coran √† voix haute pendant la pri√®re du Zuhr et Asr.",
                a: true,
                e: "On r√©cite en silence.",
                diff: 2
            },
            {
                q: "Le hadith Jibril explique les piliers de l'islam, de la foi et de l'ihsan.",
                a: true,
                e: "Hadith tr√®s c√©l√®bre (Muslim).",
                diff: 2
            },
            {
                q: "La sourate Al-Asr dit que l'homme est en perdition sauf ceux qui croient et font de bonnes actions.",
                a: true,
                e: "Et se conseillent mutuellement.",
                diff: 2
            },
            {
                q: "Il est sunnah de dire 'Amin' √† voix haute apr√®s la Fatiha.",
                a: false,
                e: "√Ä voix basse selon majorit√©, haute selon certains.",
                diff: 2
            },
            {
                q: "Le Proph√®te Ô∑∫ a interdit de je√ªner le jour de l'A√Ød.",
                a: true,
                e: "Jour de f√™te, pas de je√ªne.",
                diff: 2
            },
            {
                q: "La sourate An-Nasr annonce la victoire et l'entr√©e massive dans l'islam.",
                a: true,
                e: "R√©v√©lation tardive.",
                diff: 2
            },
            {
                q: "Il est recommand√© de lire la sourate Al-Mulk chaque soir avant de dormir.",
                a: true,
                e: "Protection jusqu'au matin.",
                diff: 2
            },
            // === Nouvelles questions - Niveau 3 (avanc√© - diff:3) - 20 questions ===
            {
                q: "Le Proph√®te Ô∑∫ a dit que la Hajj mabrur est la meilleure action apr√®s les obligations.",
                a: true,
                e: "Hadith Bukhari/Muslim.",
                diff: 3
            },
            {
                q: "La sourate Al-Bayyina est la seule sourate qui commence par 'lam yakun' sans 'qul'.",
                a: true,
                e: "Elle est mecquoise selon majorit√©.",
                diff: 3
            },
            {
                q: "Selon l'√©cole hanafite, toucher une femme non-mahram annule les ablutions.",
                a: false,
                e: "Ne les annule pas selon hanafite ; annule selon shafi'i/maliki.",
                diff: 3
            },
            {
                q: "Le hadith 'Celui qui imite un peuple fait partie d'eux' est authentique.",
                a: true,
                e: "Rapport√© par Abou Daoud et authentifi√© par Al-Albani.",
                diff: 3
            },
            {
                q: "La sourate Al-Hujurat contient le verset sur l'interdiction de se moquer d'autrui.",
                a: true,
                e: "Verset 11 tr√®s important.",
                diff: 3
            },
            {
                q: "Il est permis de faire le sa'i entre Safa et Marwa en courant pour les femmes.",
                a: false,
                e: "Seulement les hommes font le ramal et le hast (course).",
                diff: 3
            },
            {
                q: "Le Proph√®te Ô∑∫ a recommand√© de je√ªner le lundi et le jeudi.",
                a: true,
                e: "Hadith authentique.",
                diff: 3
            },
            {
                q: "Selon un hadith, la lecture de Ayat al-Kursi apr√®s chaque pri√®re prot√®ge jusqu'√† la pri√®re suivante.",
                a: true,
                e: "Rapport√© par An-Nasa√Ø.",
                diff: 3
            },
            {
                q: "La sourate At-Tawba est la seule sourate sans Bismillah au d√©but.",
                a: true,
                e: "Elle est aussi appel√©e Al-Bara'a.",
                diff: 3
            },
            {
                q: "Il est obligatoire de faire le takbirat al-tashriq du Fajr du 9 Dhul-Hijja jusqu'√† Asr du 13.",
                a: true,
                e: "Pour tous les musulmans, pas seulement p√®lerins.",
                diff: 3
            },
            {
                q: "Le hadith sur les 73 sectes est authentique et dit que seule une sera sauv√©e.",
                a: true,
                e: "Rapport√© par Tirmidhi, Abou Daoud, etc.",
                diff: 3
            },
            {
                q: "La sourate Al-Fil raconte l'ann√©e de l'√©l√©phant.",
                a: true,
                e: "Ann√©e de naissance du Proph√®te Ô∑∫.",
                diff: 3
            },
            {
                q: "Il est sunnah de lever les mains au takbir d'ouverture uniquement.",
                a: false,
                e: "Aussi avant et apr√®s le ruku' selon sunnah.",
                diff: 3
            },
            {
                q: "Le Proph√®te Ô∑∫ a interdit de vendre des fruits avant qu'ils ne soient m√ªrs.",
                a: true,
                e: "Hadith sur la gharar.",
                diff: 3
            },
            {
                q: "La sourate Al-Ma'ida contient les r√®gles du wudu d√©taill√©es.",
                a: true,
                e: "Verset 6 sur le wudu.",
                diff: 3
            },
            {
                q: "Selon la majorit√©, le voyageur peut raccourcir la pri√®re d√®s 81 km.",
                a: false,
                e: "Distance varie selon les √©coles (hanafite ~77-81 km, autres ~80-90 km).",
                diff: 3
            },
            {
                q: "Le hadith 'L'islam est b√¢ti sur 5 piliers' est rapport√© par Boukhari et Muslim.",
                a: true,
                e: "Hadith fondamental.",
                diff: 3
            },
            {
                q: "Il est interdit de r√©citer le Coran en rythme musical (chant).",
                a: false,
                e: "Permis tant que √ßa reste tajwid et non musique profane.",
                diff: 3
            },
            {
                q: "La sourate Al-Ahzab mentionne le hijab des √©pouses du Proph√®te Ô∑∫.",
                a: true,
                e: "Verset 59 sur le jilbab.",
                diff: 3
            },
            {
                q: "Le Proph√®te Ô∑∫ a dit que le meilleur dhikr est 'La ilaha illa Allah'.",
                a: true,
                e: "Hadith authentique.",
                diff: 3
            }
        ];
        // === QUESTIONS POUR LE MODE QCM (format classique : une question + 4 choix) ===
        const qcmQuestions = [{
                question: "Quelle est la couleur pr√©f√©r√©e du Proph√®te Muhammad Ô∑∫ selon plusieurs hadiths ?",
                options: ["Rouge", "Vert", "Violet", "Noir"],
                correctIndex: 1, // B
                explanation: "Rapport√© par Anas ibn Malik (hadith hasan) : le vert √©tait parmi les couleurs les plus aim√©es du Messager Ô∑∫.",
                diff: 2
            },
            {
                question: "Combien de piliers compte l'Islam ?",
                options: ["4", "5", "6", "7"],
                correctIndex: 1,
                explanation: "Les 5 piliers : Chahada, Salat, Zakat, Sawm, Hajj (hadith Jibril ‚Äì Bukhari/Muslim).",
                diff: 1
            },
            {
                question: "Quel est le premier calife de l'Islam apr√®s le Proph√®te Ô∑∫ ?",
                options: ["Omar ibn al-Khattab", "Abou Bakr As-Siddiq", "Othman ibn Affan", "Ali ibn Abi Talib"],
                correctIndex: 1,
                explanation: "Abou Bakr fut choisi √† la Saqifa de Banu Sa'ida.",
                diff: 1
            },
            {
                question: "Dans quelle sourate trouve-t-on Ayat al-Kursi ?",
                options: ["Al-Fatiha", "Al-Baqara", "Yasin", "Al-Ikhlas"],
                correctIndex: 1,
                explanation: "Verset 255 de Sourate Al-Baqara.",
                diff: 1
            },
            {
                question: "Combien de rakats compte la pri√®re obligatoire du Fajr ?",
                options: ["2", "3", "4", "5"],
                correctIndex: 0,
                explanation: "2 rakats sunnah + 2 rakats far·∏ç.",
                diff: 1
            },
            {
                question: "Quel ange est charg√© de la r√©v√©lation ?",
                options: ["Israfil", "Jibril", "Mikail", "Azra√´l"],
                correctIndex: 1,
                explanation: "Jibril (Gabriel) apporte le Coran au Proph√®te Ô∑∫.",
                diff: 1
            },
            {
                question: "Laylat al-Qadr est meilleure que combien de mois ?",
                options: ["500 mois", "1000 mois", "2000 mois", "Une vie enti√®re"],
                correctIndex: 1,
                explanation: "Sourate Al-Qadr : ¬´ meilleure que mille mois ¬ª.",
                diff: 1
            },
            {
                question: "Quel est le nom de la mosqu√©e construite par le Proph√®te Ô∑∫ √† M√©dine ?",
                options: ["Masjid al-Haram", "Masjid an-Nabawi", "Masjid al-Aqsa", "Masjid Quba"],
                correctIndex: 1,
                explanation: "Masjid an-Nabawi (la Mosqu√©e du Proph√®te).",
                diff: 1
            },
            {
                question: "Combien de fois le Proph√®te Ô∑∫ a-t-il accompli le Hajj ?",
                options: ["Jamais", "Une fois", "Deux fois", "Trois fois"],
                correctIndex: 1,
                explanation: "Hajj al-Wadaa (Hajj d'adieu) en l'an 10 de l'H√©gire.",
                diff: 2
            },
            {
                question: "Quel jour de la semaine est recommand√© pour lire Sourate Al-Kahf ?",
                options: ["Lundi", "Mardi", "Jeudi", "Vendredi"],
                correctIndex: 3,
                explanation: "Hadith authentique (Muslim) : protection du Dajjal entre deux vendredis.",
                diff: 2
            },
            {
                question: "Quelle est la premi√®re sourate r√©v√©l√©e en entier ?",
                options: ["Al-Fatiha", "Al-Alaq", "Al-Muddaththir", "Al-Muzzammil"],
                correctIndex: 1,
                explanation: "Sourate Al-Alaq (versets 1-5) : premi√®re r√©v√©lation.",
                diff: 2
            },
            {
                question: "Le je√ªne de 'Achoura est recommand√© les 9 et 10 Muharram pour :",
                options: ["imiter les Juifs", "se distinguer des Juifs", "c√©l√©brer une victoire", "comm√©morer No√©"],
                correctIndex: 1,
                explanation: "Hadith Bukhari : ¬´ Nous je√ªnerons le 9 avec le 10 pour nous diff√©rencier des Gens du Livre ¬ª.",
                diff: 2
            },
            {
                question: "Quelle sourate n'a pas de Bismillah au d√©but ?",
                options: ["At-Tawba", "Al-Fatiha", "An-Nas", "Al-Falaq"],
                correctIndex: 0,
                explanation: "Sourate At-Tawba (Al-Bara'a) est la seule sans Bismillah.",
                diff: 3
            },
            {
                question: "Quel est le nom du hadith qui commence par ¬´ Les actions ne valent que par les intentions ¬ª ?",
                options: ["Hadith Jibril", "Hadith de l'intention", "Hadith d'Omar", "Hadith Qudsi"],
                correctIndex: 1,
                explanation: "Premier hadith du Sahih Bukhari.",
                diff: 2
            },
            {
                question: "La Qibla a √©t√© chang√©e de J√©rusalem vers La Mecque apr√®s combien d'ann√©es √† M√©dine ?",
                options: ["6 mois", "17 mois", "2 ans", "5 ans"],
                correctIndex: 1,
                explanation: "Verset 144 de Sourate Al-Baqara ‚Äì apr√®s environ 17 mois.",
                diff: 3
            },
            // === 20 NOUVELLES QUESTIONS QCM (ajout√©es ici) ===
            {
                question: "Quel est le deuxi√®me pilier de l'Islam ?",
                options: ["La Chahada", "La Salat", "La Zakat", "Le Sawm"],
                correctIndex: 1, // B
                explanation: "La pri√®re (Salat) est le deuxi√®me pilier apr√®s la profession de foi.",
                diff: 1
            },
            {
                question: "Dans quelle ville le Proph√®te Ô∑∫ est-il d√©c√©d√© ?",
                options: ["La Mecque", "M√©dine", "Ta√Øf", "J√©rusalem"],
                correctIndex: 1,
                explanation: "Il est d√©c√©d√© √† M√©dine en l'an 11 de l'H√©gire.",
                diff: 1
            },
            {
                question: "Combien de versets compte la sourate la plus longue du Coran ?",
                options: ["286", "200", "176", "114"],
                correctIndex: 0,
                explanation: "Sourate Al-Baqara compte 286 versets.",
                diff: 2
            },
            {
                question: "Quel compagnon a √©t√© surnomm√© 'As-Siddiq' ?",
                options: ["Omar ibn al-Khattab", "Abou Bakr", "Othman ibn Affan", "Ali ibn Abi Talib"],
                correctIndex: 1,
                explanation: "Abou Bakr As-Siddiq, le v√©ridique.",
                diff: 1
            },
            {
                question: "Quelle est la premi√®re sourate compl√®te r√©v√©l√©e au Proph√®te Ô∑∫ ?",
                options: ["Al-Fatiha", "Al-Alaq", "Al-Muddaththir", "Ad-Duha"],
                correctIndex: 2,
                explanation: "Sourate Al-Muddaththir (versets 1 √† 7) apr√®s les premiers versets d'Al-Alaq.",
                diff: 3
            },
            {
                question: "Quel est le nom de l'ange charg√© de la subsistance (pluie, nourriture) ?",
                options: ["Jibril", "Israfil", "Mikail", "Azra√´l"],
                correctIndex: 2,
                explanation: "Mikail est l'ange de la subsistance et de la pluie.",
                diff: 2
            },
            {
                question: "La sourate qui parle de l'histoire de l'√©l√©phant s'appelle :",
                options: ["Al-Fil", "Al-Qadr", "Al-Kawthar", "Al-Falaq"],
                correctIndex: 0,
                explanation: "Sourate Al-Fil (105) raconte l'ann√©e de l'√©l√©phant.",
                diff: 1
            },
            {
                question: "Combien de fois faut-il tourner autour de la Kaaba pendant le Tawaf ?",
                options: ["5", "7", "9", "12"],
                correctIndex: 1,
                explanation: "7 tours obligatoires.",
                diff: 1
            },
            {
                question: "Quel hadith commence par 'Celui qui ment sur moi intentionnellement...' ?",
                options: ["Hadith de l'intention", "Hadith du mensonge", "Hadith Jibril", "Hadith de la mis√©ricorde"],
                correctIndex: 1,
                explanation: "Celui qui ment sur moi intentionnellement, qu'il prenne sa place en Enfer (Bukhari/Muslim).",
                diff: 2
            },
            {
                question: "La bataille de Badr a eu lieu en quelle ann√©e de l'H√©gire ?",
                options: ["1 AH", "2 AH", "3 AH", "5 AH"],
                correctIndex: 1,
                explanation: "2 AH ‚Äì premi√®re grande bataille.",
                diff: 3
            },
            {
                question: "Quel est le nom du p√®re du Proph√®te Muhammad Ô∑∫ ?",
                options: ["Abdullah", "Abdul Muttalib", "Abu Talib", "Hamza"],
                correctIndex: 0,
                explanation: "Abdullah ibn Abdul Muttalib.",
                diff: 1
            },
            {
                question: "La sourate qui √©quivaut au tiers du Coran est :",
                options: ["Al-Fatiha", "Al-Ikhlas", "Al-Kawthar", "Al-Asr"],
                correctIndex: 1,
                explanation: "Sourate Al-Ikhlas (112).",
                diff: 1
            },
            {
                question: "Quel est le mois qui suit Ramadan ?",
                options: ["Shawwal", "Dhul-Qa'dah", "Muharram", "Safar"],
                correctIndex: 0,
                explanation: "Shawwal ‚Äì commence par l'A√Ød al-Fitr.",
                diff: 1
            },
            {
                question: "La premi√®re mosqu√©e construite en Islam est :",
                options: ["Masjid an-Nabawi", "Masjid Quba", "Masjid al-Haram", "Masjid al-Aqsa"],
                correctIndex: 1,
                explanation: "Masjid Quba, construite par le Proph√®te Ô∑∫ lors de l'H√©gire.",
                diff: 2
            },
            {
                question: "Quel est le nom de la sourate qui parle des bienfaits d'Allah sur l'homme ?",
                options: ["Ar-Rahman", "Al-Waqi'a", "Al-Mulk", "Al-Insan"],
                correctIndex: 0,
                explanation: "Sourate Ar-Rahman (55) ‚Äì 'Alors lequel des bienfaits de votre Seigneur oserez-vous renier ?'.",
                diff: 2
            },
            {
                question: "Le Proph√®te Ô∑∫ a re√ßu la r√©v√©lation pendant combien d'ann√©es ?",
                options: ["20 ans", "23 ans", "25 ans", "30 ans"],
                correctIndex: 1,
                explanation: "23 ans au total (13 √† La Mecque + 10 √† M√©dine).",
                diff: 1
            },
            {
                question: "Quel compagnon a compil√© le Coran sous Abou Bakr ?",
                options: ["Omar", "Zayd ibn Thabit", "Ali", "Ubayy ibn Ka'b"],
                correctIndex: 1,
                explanation: "Zayd ibn Thabit a dirig√© la premi√®re compilation.",
                diff: 3
            },
            {
                question: "La pri√®re de Tarawih est effectu√©e pendant :",
                options: ["Ramadan", "Shawwal", "Muharram", "Dhul-Hijja"],
                correctIndex: 0,
                explanation: "Sp√©cifiquement pendant le mois de Ramadan.",
                diff: 1
            },
            {
                question: "Quel est le nom du puits b√©ni √† M√©dine ?",
                options: ["Zamzam", "Bir Ruma", "Al-Aris", "Al-Ghars"],
                correctIndex: 1,
                explanation: "Bir Ruma, achet√© par Othman ibn Affan.",
                diff: 3
            },
            {
                question: "La sourate qui commence par 'Qul huwa Allahu ahad' est :",
                options: ["Al-Falaq", "An-Nas", "Al-Ikhlas", "Al-Kafirun"],
                correctIndex: 2,
                explanation: "Sourate Al-Ikhlas (112).",
                diff: 1
            },
            // === 20 AUTRES NOUVELLES QUESTIONS QCM (√† ajouter √† la suite) ===
            {
                question: "Quel est le nom de la m√®re du Proph√®te Muhammad Ô∑∫ ?",
                options: ["Amina bint Wahb", "Halima as-Sa'diyya", "Khadija bint Khuwaylid", "Fatima bint Asad"],
                correctIndex: 0,
                explanation: "Amina bint Wahb, d√©c√©d√©e quand le Proph√®te avait 6 ans.",
                diff: 1
            },
            {
                question: "La sourate qui parle du voyage nocturne (Isra) et de l'ascension (Mi'raj) est :",
                options: ["Al-Isra", "Al-Mi'raj", "An-Najm", "Al-Fajr"],
                correctIndex: 0,
                explanation: "Sourate Al-Isra (17), verset 1.",
                diff: 2
            },
            {
                question: "Combien de compagnons ont particip√© √† la bataille de Badr ?",
                options: ["313", "700", "1000", "1500"],
                correctIndex: 0,
                explanation: "Environ 313 musulmans contre 1000 Qurayshites.",
                diff: 2
            },
            {
                question: "Quel est le nom du trait√© sign√© entre le Proph√®te Ô∑∫ et les Qurayshites √† Hudaybiya ?",
                options: ["Trait√© de Hudaybiya", "Trait√© d'Aqaba", "Pacte de M√©dine", "Trait√© de Ta√Øf"],
                correctIndex: 0,
                explanation: "Sulh al-Hudaybiya (6 AH), paix de 10 ans.",
                diff: 2
            },
            {
                question: "La zakat devient obligatoire sur l'or √† partir de combien de grammes (nisab) ?",
                options: ["50 g", "85 g", "100 g", "200 g"],
                correctIndex: 1,
                explanation: "85 grammes d'or pur (environ 20 mithqal).",
                diff: 2
            },
            {
                question: "Quel compagnon a √©t√© le premier √† r√©citer le Coran √† haute voix √† La Mecque ?",
                options: ["Abou Bakr", "Omar ibn al-Khattab", "Abdullah ibn Mas'ud", "Bilal ibn Rabah"],
                correctIndex: 2,
                explanation: "Abdullah ibn Mas'ud, pr√®s de la Kaaba.",
                diff: 3
            },
            {
                question: "La sourate qui mentionne le nom de Marie (Maryam) dans son titre est :",
                options: ["Al-Imran", "Maryam", "An-Nisa", "At-Tahrim"],
                correctIndex: 1,
                explanation: "Sourate Maryam (19).",
                diff: 1
            },
            {
                question: "Quel est le nombre minimum de personnes pour constituer une pri√®re en congr√©gation (jama'a) ?",
                options: ["2", "3", "4", "5"],
                correctIndex: 1,
                explanation: "Au moins 2 (l'imam + 1 fid√®le), selon la majorit√©.",
                diff: 2
            },
            {
                question: "Le Proph√®te Ô∑∫ a dit : 'Le musulman est celui dont les musulmans sont √† l'abri de sa langue et de sa main'. Ce hadith est class√© :",
                options: ["Faible", "Hasan", "Sahih", "Mawdu'"],
                correctIndex: 2,
                explanation: "Hadith sahih rapport√© par Bukhari et Muslim.",
                diff: 2
            },
            {
                question: "Quelle est la dur√©e minimale du s√©jour √† Mina pendant le Hajj ?",
                options: ["1 jour", "2 jours", "3 jours", "4 jours"],
                correctIndex: 1,
                explanation: "Au moins 2 jours (11 et 12 Dhul-Hijja), ou 3 pour le Hajj complet.",
                diff: 3
            },
            {
                question: "Quel est le nom du p√®re d'Ibrahim (Abraham) selon le Coran ?",
                options: ["Azar", "Terah", "Nahor", "Haran"],
                correctIndex: 0,
                explanation: "Azar (Sourate Al-An'am 74).",
                diff: 2
            },
            {
                question: "La pri√®re de l'Eid al-Fitr se fait en combien de rakats ?",
                options: ["2 rakats", "4 rakats", "3 rakats", "6 rakats"],
                correctIndex: 0,
                explanation: "2 rakats avec takbirs suppl√©mentaires.",
                diff: 1
            },
            {
                question: "Quel compagnon a √©t√© nomm√© gouverneur du Y√©men par le Proph√®te Ô∑∫ ?",
                options: ["Mu'adh ibn Jabal", "Abu Musa al-Ash'ari", "Ubaydullah ibn Jahsh", "Zayd ibn Haritha"],
                correctIndex: 0,
                explanation: "Mu'adh ibn Jabal, c√©l√®bre pour sa connaissance du halal/haram.",
                diff: 3
            },
            {
                question: "La sourate qui parle de la bataille d'Uhud est :",
                options: ["Al-Anfal", "Al-Imran", "Al-Ahzab", "Al-Hashr"],
                correctIndex: 1,
                explanation: "Sourate Al-Imran (versets 121‚Äì180 environ).",
                diff: 3
            },
            {
                question: "Quel est le nom de la premi√®re √©pouse du Proph√®te Ô∑∫ ?",
                options: ["A√Øcha", "Khadija bint Khuwaylid", "Sawda", "Hafsa"],
                correctIndex: 1,
                explanation: "Khadija bint Khuwaylid, m√®re de la plupart de ses enfants.",
                diff: 1
            },
            {
                question: "Le je√ªne du jour de 'Arafat (9 Dhul-Hijja) efface les p√©ch√©s :",
                options: ["de l'ann√©e pass√©e et √† venir", "de 2 ans", "de 10 ans", "seulement mineurs"],
                correctIndex: 0,
                explanation: "Hadith authentique : efface les p√©ch√©s de l'ann√©e pass√©e et de l'ann√©e √† venir (Muslim).",
                diff: 2
            },
            {
                question: "Quel est le nom du livre r√©v√©l√© √† Dawud (David) ?",
                options: ["Tawrat", "Zabur", "Injil", "Qur'an"],
                correctIndex: 1,
                explanation: "Le Zabur (Psaumes).",
                diff: 2
            },
            {
                question: "La sourate qui mentionne les 5 pri√®res quotidiennes est :",
                options: ["Al-Baqara", "Hud", "Al-Isra", "Ta-Ha"],
                correctIndex: 2,
                explanation: "Sourate Al-Isra (17:78) mentionne Fajr, Zuhr, Asr, Maghrib, Isha.",
                diff: 3
            },
            {
                question: "Quel compagnon a √©t√© le premier mu'adhin de l'Islam ?",
                options: ["Bilal ibn Rabah", "Abu Bakr", "Abdullah ibn Mas'ud", "Salman al-Farisi"],
                correctIndex: 0,
                explanation: "Bilal ibn Rabah, affranchi par Abou Bakr.",
                diff: 1
            },
            {
                question: "Le nombre de rakats sur√©rogatoires recommand√©s avant et apr√®s les pri√®res obligatoires est :",
                options: ["10 rakats au total", "12 rakats au total", "14 rakats au total", "16 rakats au total"],
                correctIndex: 1,
                explanation: "12 rakats sunnah rawatib : 2 avant Fajr, 4 avant + 2 apr√®s Zuhr, 2 apr√®s Maghrib, 2 apr√®s Isha.",
                diff: 2
            },
            // === 20 NOUVELLES QUESTIONS QCM (41 √† 60) ===
            {
                question: "Quel est le nom du premier homme cr√©√© par Allah ?",
                options: ["Adam", "Nuh", "Ibrahim", "Musa"],
                correctIndex: 0,
                explanation: "Adam (ÿπŸÑŸäŸá ÿßŸÑÿ≥ŸÑÿßŸÖ), le p√®re de l'humanit√©.",
                diff: 1
            },
            {
                question: "La sourate qui parle de la cr√©ation de l'homme √† partir d'une goutte est :",
                options: ["Al-Alaq", "Al-Mu'minun", "At-Tariq", "Al-Insan"],
                correctIndex: 0,
                explanation: "Sourate Al-Alaq (96:2) : 'Il a cr√©√© l'homme d'une adh√©sion (alaq)'.",
                diff: 2
            },
            {
                question: "Combien de fois le nom 'Allah' est-il mentionn√© dans le Coran ?",
                options: ["2698", "114", "99", "6236"],
                correctIndex: 0,
                explanation: "Environ 2698 fois (selon les comptages classiques).",
                diff: 3
            },
            {
                question: "Quel proph√®te a √©t√© envoy√© √† son peuple avec le miracle de la canne qui devient serpent ?",
                options: ["Musa", "Harun", "Dawud", "Sulayman"],
                correctIndex: 0,
                explanation: "Musa (Mo√Øse) ‚Äì Sourate Al-A'raf et autres.",
                diff: 1
            },
            {
                question: "La pri√®re du Witr est g√©n√©ralement accomplie apr√®s quelle pri√®re obligatoire ?",
                options: ["Fajr", "Dhuhr", "Isha", "Asr"],
                correctIndex: 2,
                explanation: "Apr√®s la pri√®re d'Isha (pri√®re de nuit).",
                diff: 1
            },
            {
                question: "Quel est le nom de la sourate qui commence par 'Nun wal-qalam' ?",
                options: ["Al-Qalam", "Al-Muzzammil", "Al-Muddaththir", "An-Naba"],
                correctIndex: 0,
                explanation: "Sourate Al-Qalam (68).",
                diff: 2
            },
            {
                question: "Le Proph√®te Ô∑∫ a dit : 'Celui qui je√ªne le jour de 'Arafat, Allah lui pardonne...' :",
                options: ["les p√©ch√©s de deux ans", "les p√©ch√©s de dix ans", "tous ses p√©ch√©s majeurs", "seulement les p√©ch√©s mineurs"],
                correctIndex: 0,
                explanation: "Hadith sahih (Muslim) : l'ann√©e pass√©e et l'ann√©e √† venir.",
                diff: 2
            },
            {
                question: "Quel compagnon a √©t√© le premier √† embrasser l'Islam parmi les hommes libres ?",
                options: ["Abou Bakr", "Omar", "Ali", "Zayd ibn Haritha"],
                correctIndex: 0,
                explanation: "Abou Bakr As-Siddiq.",
                diff: 2
            },
            {
                question: "La sourate qui mentionne le 'Mizan' (balance) le Jour du Jugement est :",
                options: ["Al-Qari'a", "Al-Infitar", "At-Takwir", "Al-Inshiqaq"],
                correctIndex: 0,
                explanation: "Sourate Al-Qari'a (101).",
                diff: 3
            },
            {
                question: "Quel est le nom du mont o√π le Proph√®te Ô∑∫ a re√ßu la premi√®re r√©v√©lation ?",
                options: ["Mont Thawr", "Mont Hira", "Mont Uhud", "Mont Safa"],
                correctIndex: 1,
                explanation: "Grotte de Hira (Jabal an-Nour).",
                diff: 1
            },
            {
                question: "La zakat al-fitr doit √™tre donn√©e avant :",
                options: ["la pri√®re de l'A√Ød", "le coucher du soleil du 30 Ramadan", "le lever du soleil du jour de l'A√Ød", "la pri√®re de Fajr du jour de l'A√Ød"],
                correctIndex: 0,
                explanation: "Id√©alement avant la pri√®re de l'A√Ød (sunnah forte).",
                diff: 2
            },
            {
                question: "Quel proph√®te a construit l'arche sur ordre d'Allah ?",
                options: ["Ibrahim", "Nuh", "Musa", "Yunus"],
                correctIndex: 1,
                explanation: "Nuh (No√©) ‚Äì Sourate Hud.",
                diff: 1
            },
            {
                question: "La sourate qui parle des 'Ashab al-Kahf' (gens de la caverne) est :",
                options: ["Al-Kahf", "Yasin", "Maryam", "Al-Anbiya"],
                correctIndex: 0,
                explanation: "Sourate Al-Kahf (18).",
                diff: 1
            },
            {
                question: "Combien de takbirs suppl√©mentaires sont recommand√©s au d√©but de la pri√®re de l'A√Ød ?",
                options: ["5 au premier rakat, 4 au second", "7 au premier, 5 au second", "3 au premier, 3 au second", "9 au premier, 7 au second"],
                correctIndex: 1,
                explanation: "7 au premier rakat, 5 au second (selon la majorit√©).",
                diff: 2
            },
            {
                question: "Quel est le nom du p√®re de Maryam (Marie) ?",
                options: ["Imran", "Zakariyya", "Yahya", "Harun"],
                correctIndex: 0,
                explanation: "Imran ‚Äì Sourate Al-Imran et Maryam.",
                diff: 2
            },
            {
                question: "Le Proph√®te Ô∑∫ a interdit de je√ªner uniquement le jour :",
                options: ["du vendredi", "de l'A√Ød", "de 'Achoura", "de 'Arafat"],
                correctIndex: 0,
                explanation: "Vendredi seul (sauf si li√© √† un autre jour) ‚Äì hadith sahih.",
                diff: 2
            },
            {
                question: "Quelle sourate est appel√©e 'le c≈ìur du Coran' ?",
                options: ["Al-Fatiha", "Yasin", "Al-Ikhlas", "Al-Mulk"],
                correctIndex: 1,
                explanation: "Sourate Yasin ‚Äì hadith rapport√© par Tirmidhi.",
                diff: 1
            },
            {
                question: "Le nombre de sajda (prosternations) dans tout le Coran est :",
                options: ["14", "15", "17", "20"],
                correctIndex: 0,
                explanation: "14 sajda de tilawa (selon la majorit√© des savants).",
                diff: 3
            },
            {
                question: "Quel compagnon a √©t√© martyris√© √† la bataille d'Uhud et est enterr√© l√†-bas ?",
                options: ["Hamza ibn Abdul Muttalib", "Mus'ab ibn Umayr", "Abdullah ibn Jahsh", "Tous les trois"],
                correctIndex: 3,
                explanation: "Les trois ont √©t√© martyrs √† Uhud.",
                diff: 3
            },
            {
                question: "La sourate qui termine par 'Qul a'udhu birabbil-falaq' est :",
                options: ["Al-Falaq", "An-Nas", "Al-Ikhlas", "Al-Kafirun"],
                correctIndex: 0,
                explanation: "Sourate Al-Falaq (113).",
                diff: 1
            }
        ];
        // NOUVELLES CONSTANTES SHOP & CADEAU QUOTIDIEN
        const DAILY_COOLDOWN_MS = 86400000; // 24 heures en millisecondes
        const SHOP_ITEMS = {
            'XP_BOOST_X2': ['Double XP (x1 Partie)', 500, "Multiplie l'XP gagn√©e par 2 pendant 1 partie classique/chrono.", 'PERK'],
            'HINT_TOKEN': ['Indice (Usage Unique)', 400, "R√©v√®le la bonne r√©ponse de la question VRAI/FAUX actuelle.", 'CONSUMABLE'],
            'INFINITE_REVIVE': ['Revive Infini', 1000, "Permet de faire une erreur de plus en Mode Infini.", 'CONSUMABLE'],
            'DAILY_REROLL': ['Reset D√©fi du Jour', 1500, "Permet de rejouer imm√©diatement au D√©fi du Jour.", 'CONSUMABLE'],
        };

        // Structure des r√©compenses al√©atoires du cadeau de connexion
        const DAILY_GIFT_REWARDS = [
            // Type : 'points', 'xp' ou 'item' (si 'item', l'ID doit correspondre √† une cl√© de SHOP_ITEMS)
            // Les points sont toujours donn√©s (probability: 100)
            {
                type: 'points',
                min: 100,
                max: 500,
                probability: 100,
                label: 'Points Boutique'
            },

            // R√©compenses al√©atoires
            {
                type: 'xp',
                min: 50,
                max: 250,
                probability: 60,
                label: 'XP'
            },
            {
                type: 'item',
                id: 'HINT_TOKEN',
                min: 1,
                max: 2,
                probability: 40,
                label: 'Indice(s)'
            },
            {
                type: 'item',
                id: 'XP_BOOST_X2',
                min: 1,
                max: 1,
                probability: 10,
                label: 'Boost XP x2'
            },
            {
                type: 'item',
                id: 'DAILY_REROLL',
                min: 1,
                max: 1,
                probability: 5,
                label: 'Reroll Quotidien'
            },
        ];

        let currentUser = null,
            current = 0,
            score = 0,
            quiz = [],
            streak = 0,
            isInfiniteMode = !1,
            isChronoMode = !1,
            isQCMMode = !1,
            xpPerCorrect = 10,
            xpToNextLevel = 100,
            timer, dailyTimerInterval;
        const NEXT_QUESTION_DELAY = 3e3,
            initialBots = [{
                pseudo: "Ibrahim",
                totalXp: 15e3
            }, {
                pseudo: "A√Øcha",
                totalXp: 9500
            }, {
                pseudo: "Moussa",
                totalXp: 6e3
            }, {
                pseudo: "Fatima",
                totalXp: 3500
            }, {
                pseudo: "Ali",
                totalXp: 1200
            }];
        let isAnswered = !1;
        let totalQCMCompleted = 0;
        let shopTimerInterval;

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function calculateXpToNextLevel(e) {
            return 100 * Math.pow(1.5, e - 1)
        }

        function shuffleArray(e) {
            for (let t = e.length - 1; t > 0; t--) {
                const s = Math.floor(Math.random() * (t + 1));
                [e[t], e[s]] = [e[s], e[t]]
            }
            return e
        }

        if (localStorage.getItem("currentUser")) {
            currentUser = JSON.parse(localStorage.getItem("currentUser"));

            currentUser.dailyQuizLastPlayed = currentUser.dailyQuizLastPlayed || 0;
            currentUser.totalQCMCompleted = currentUser.totalQCMCompleted || 0;
            currentUser.points = currentUser.points || 0;
            currentUser.ownedItems = currentUser.ownedItems || {
                'XP_BOOST_X2': 0,
                'HINT_TOKEN': 0,
                'INFINITE_REVIVE': 0,
                'DAILY_REROLL': 0
            };
            currentUser.shopLastRefresh = currentUser.shopLastRefresh || 0;
            currentUser.dailyShopItems = currentUser.dailyShopItems || [];
            currentUser.dailyGiftLastCollected = currentUser.dailyGiftLastCollected || 0;

            // NOUVEAUX COMPTEURS (si non pr√©sents)
            currentUser.chronoGamesPlayed = currentUser.chronoGamesPlayed || 0;
            currentUser.chronoPerfects = currentUser.chronoPerfects || 0;
            currentUser.infiniteBest = currentUser.infiniteBest || currentUser.best || 0;
            currentUser.qcmPerfects = currentUser.qcmPerfects || 0;
            currentUser.shopItemsBoughtTotal = currentUser.shopItemsBoughtTotal || 0;
            currentUser.shopPointsSpent = currentUser.shopPointsSpent || 0;
            currentUser.dailyQuizzesCompleted = currentUser.dailyQuizzesCompleted || 0;
            currentUser.dailyRerollsOwnedMax = currentUser.dailyRerollsOwnedMax || currentUser.ownedItems['DAILY_REROLL'] || 0;

            totalQCMCompleted = currentUser.totalQCMCompleted;
            generateDailyShop();

            document.getElementById("auth").classList.add("hidden");
            showMenu();
        }

        function saveUser() {
            currentUser.totalQCMCompleted = totalQCMCompleted;
            localStorage.setItem("user_" + currentUser.pseudo, JSON.stringify(currentUser));
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
        }

        function register() {
            const e = document.getElementById("pseudo").value.trim(),
                t = document.getElementById("password").value;
            if (e.length < 3 || t.length < 4) return alert("Pseudo ‚â•3 | Mot de passe ‚â•4");
            if (localStorage.getItem("user_" + e)) return alert("Pseudo d√©j√† pris");

            currentUser = {
                pseudo: e,
                pass: t,
                level: 1,
                xp: 0,
                totalXp: 0,
                streak: 0,
                best: 0,
                totalCorrect: 0,
                totalQuestions: 0,
                achievements: Array(26).fill(0), // ‚Üê Augment√© √† 26 pour les nouveaux succ√®s
                dailyQuizLastPlayed: 0,
                totalQCMCompleted: 0,
                points: 1000,
                ownedItems: {
                    'XP_BOOST_X2': 0,
                    'HINT_TOKEN': 0,
                    'INFINITE_REVIVE': 0,
                    'DAILY_REROLL': 0
                },
                shopLastRefresh: 0,
                dailyShopItems: [],
                dailyGiftLastCollected: 0,

                // NOUVEAUX COMPTEURS
                chronoGamesPlayed: 0,
                chronoPerfects: 0,
                infiniteBest: 0,
                qcmPerfects: 0,
                shopItemsBoughtTotal: 0,
                shopPointsSpent: 0,
                dailyQuizzesCompleted: 0,
                dailyRerollsOwnedMax: 0
            };
            totalQCMCompleted = 0;
            generateDailyShop();
            saveUser();
            document.getElementById("auth").classList.add("hidden");
            showMenu();
        }

        function login() {
            const e = document.getElementById("pseudo").value.trim(),
                t = document.getElementById("password").value,
                s = localStorage.getItem("user_" + e);
            if (!s) return alert("Pseudo inconnu");
            const n = JSON.parse(s);
            if (n.pass !== t) return alert("Mot de passe incorrect");

            currentUser = n;

            currentUser.dailyQuizLastPlayed = currentUser.dailyQuizLastPlayed || 0;
            currentUser.totalQCMCompleted = currentUser.totalQCMCompleted || 0;
            currentUser.points = currentUser.points || 0;
            currentUser.ownedItems = currentUser.ownedItems || {
                'XP_BOOST_X2': 0,
                'HINT_TOKEN': 0,
                'INFINITE_REVIVE': 0,
                'DAILY_REROLL': 0
            };
            currentUser.shopLastRefresh = currentUser.shopLastRefresh || 0;
            currentUser.dailyShopItems = currentUser.dailyShopItems || [];
            currentUser.dailyGiftLastCollected = currentUser.dailyGiftLastCollected || 0;

            // NOUVEAUX COMPTEURS (si non pr√©sents)
            currentUser.chronoGamesPlayed = currentUser.chronoGamesPlayed || 0;
            currentUser.chronoPerfects = currentUser.chronoPerfects || 0;
            currentUser.infiniteBest = currentUser.infiniteBest || currentUser.best || 0;
            currentUser.qcmPerfects = currentUser.qcmPerfects || 0;
            currentUser.shopItemsBoughtTotal = currentUser.shopItemsBoughtTotal || 0;
            currentUser.shopPointsSpent = currentUser.shopPointsSpent || 0;
            currentUser.dailyQuizzesCompleted = currentUser.dailyQuizzesCompleted || 0;
            currentUser.dailyRerollsOwnedMax = currentUser.dailyRerollsOwnedMax || currentUser.ownedItems['DAILY_REROLL'] || 0;

            totalQCMCompleted = currentUser.totalQCMCompleted;

            generateDailyShop();
            saveUser();
            document.getElementById("auth").classList.add("hidden");
            showMenu();
        }

        function logout() {
            localStorage.removeItem("currentUser"), location.reload()
        }

        function resetAccount() {
            confirm("Tout supprimer ? (niveau, XP, succ√®s‚Ä¶)") && (localStorage.removeItem("user_" + currentUser.pseudo), localStorage.removeItem("currentUser"), location.reload())
        }

        function showScreen(e) {
            ["auth", "menu", "game", "settings", "achievements", "leaderboard", "difficultyMenu", "shop"].forEach(t => document.getElementById(t).classList.add("hidden")), document.getElementById(e).classList.remove("hidden")
        }

        function updateStats() {
            if (!currentUser) return;

            xpToNextLevel = calculateXpToNextLevel(currentUser.level);
            while (currentUser.xp >= xpToNextLevel) {
                document.getElementById("levelup").play();
                currentUser.level++;
                currentUser.xp -= xpToNextLevel;
                xpToNextLevel = calculateXpToNextLevel(currentUser.level);
            }
            document.getElementById("username").textContent = currentUser.pseudo,
                document.getElementById("levelNum").textContent = currentUser.level,
                document.getElementById("streak").textContent = currentUser.streak,
                document.getElementById("best").textContent = currentUser.best,
                document.getElementById("xp").textContent = Math.round(currentUser.xp),
                document.getElementById("xpMax").textContent = Math.round(xpToNextLevel),
                document.getElementById("xpFill").style.width = `${currentUser.xp/xpToNextLevel*100}%`,
                   document.getElementById("username2").textContent = currentUser.pseudo;
    document.getElementById("levelNum2").textContent = currentUser.level;
    document.getElementById("totalXp").textContent = Math.round(currentUser.totalXp);

    // Mise √† jour s√©curis√©e des √©l√©ments du menu (seulement s'ils existent)
    const pointsElem = document.getElementById("userPoints");
    if (pointsElem) {
        pointsElem.textContent = currentUser.points.toLocaleString();
    }

    const rerollElem = document.getElementById("rerollCount");
    if (rerollElem) {
        rerollElem.textContent = currentUser.ownedItems['DAILY_REROLL'];
    }

    const hintElem = document.getElementById("hintCount");
    if (hintElem) {
        hintElem.textContent = currentUser.ownedItems['HINT_TOKEN'];
    }

    checkAchievements();
    saveUser();
}
        function showMenu() {
            showScreen("menu"), updateStats();

            checkAndCollectDailyGift();

            checkDailyQuizAvailability();
            const e = document.getElementById("answers");
            e.innerHTML = `<div class="ans vrai" onclick="answer(true)">VRAI</div><div class="ans faux" onclick="answer(false)">FAUX</div>`;
            e.classList.remove("qcm-style");

            if (shopTimerInterval) clearInterval(shopTimerInterval);

            if (!document.getElementById('countdownTimer').dataset.started) {
                startRamadanCountdown();
                document.getElementById('countdownTimer').dataset.started = "true";
            }
        }

        function showSettings() {
            showScreen("settings"), updateStats()
        }

        function showAchievements() {
            showScreen("achievements"), updateStats()
        }

        function showDifficultyMenu() {
            showScreen("difficultyMenu")
        }

        function showPopup(emoji, title, text) {
            document.getElementById("popupEmoji").textContent = emoji;
            document.getElementById("popupTitle").textContent = title;
            document.getElementById("popupText").textContent = text;
            document.getElementById("popup").classList.add("show");
            setTimeout(() => {
                document.getElementById("popup").classList.remove("show")
            }, 4e3);
        }

        function checkAndCollectDailyGift() {
            if (typeof currentUser.dailyGiftLastCollected === 'undefined') {
                currentUser.dailyGiftLastCollected = 0;
            }
            if (Date.now() - currentUser.dailyGiftLastCollected < DAILY_COOLDOWN_MS) {
                return;
            }

            let collectedRewards = [];
            let totalXpGained = 0;
            DAILY_GIFT_REWARDS.forEach(reward => {
                const roll = getRandomInt(1, 100);

                if (roll <= reward.probability) {
                    const amount = getRandomInt(reward.min, reward.max);
                    switch (reward.type) {
                        case 'points':
                            currentUser.points += amount;
                            break;
                        case 'xp':
                            currentUser.xp += amount;
                            currentUser.totalXp += amount;
                            totalXpGained += amount;
                            break;
                        case 'item':
                            currentUser.ownedItems[reward.id] = (currentUser.ownedItems[reward.id] || 0) + amount;
                            break;
                    }
                    collectedRewards.push(`${amount.toLocaleString()} ${reward.label}`);
                }
            });
            currentUser.dailyGiftLastCollected = Date.now();
            saveUser();
            updateStats();
            if (collectedRewards.length > 0) {
                const rewardMessage = collectedRewards.join('\n');
                let title = "Cadeau Quotidien !";
                let text = `MashaAllah ! Vous avez gagn√© :\n${rewardMessage}`;

                showPopup('üéÅ', title, text);
            }
        }

        function getMidnightTime(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            return d.getTime();
        }

        function generateDailyShop() {
            const now = Date.now();
            const midnightToday = getMidnightTime(now);
            const midnightTomorrow = getMidnightTime(now + DAILY_COOLDOWN_MS);
            if (currentUser.shopLastRefresh < midnightToday || currentUser.dailyShopItems.length === 0) {
                console.log("G√©n√©ration du nouveau shop...");

                const allItemKeys = Object.keys(SHOP_ITEMS);
                const selectedKeys = shuffleArray(allItemKeys).slice(0, 3);

                currentUser.dailyShopItems = [];
                selectedKeys.forEach(key => {
                    const item = SHOP_ITEMS[key];
                    const basePrice = item[1];

                    const randomModifier = Math.floor(Math.random() * 66) - 50;
                    const finalPrice = Math.round(basePrice * (1 + randomModifier / 100));

                    const maxStock = (key === 'HINT_TOKEN' ? 5 :
                        key === 'XP_BOOST_X2' ? 3 :
                        key === 'INFINITE_REVIVE' ? 1 : 1);
                    const stock = Math.floor(Math.random() * maxStock) + 1;
                    currentUser.dailyShopItems.push({
                        code: key,
                        name: item[0],
                        price: finalPrice,
                        originalPrice: basePrice,
                        stock: stock,
                        description: item[2],
                    });
                });
                currentUser.shopLastRefresh = midnightToday;
                saveUser();
            }

            return midnightTomorrow - now;
        }

        function updateShopTimerDisplay(ms) {
            const t = document.getElementById("shopChrono");

            const seconds = Math.floor(ms / 1000);
            if (seconds <= 0) {
                t.textContent = "Actualisation en cours... (Retournez au menu)";
                if (shopTimerInterval) clearInterval(shopTimerInterval);
                return;
            }

            const h = Math.floor(seconds / 3600);
            const m = Math.floor(seconds % 3600 / 60);
            const s = seconds % 60;

            const i = String(h).padStart(2, "0"),
                c = String(m).padStart(2, "0"),
                r = String(s).padStart(2, "0");
            t.textContent = `Actualisation dans : ${i}h ${c}m ${r}s`;
        }

        function showShop() {
            showScreen("shop");

            if (shopTimerInterval) clearInterval(shopTimerInterval);

            let timeLeft = generateDailyShop();
            const shopContainer = document.getElementById("shopItemsContainer");
            shopContainer.innerHTML = '';
            updateShopTimerDisplay(timeLeft);
            shopTimerInterval = setInterval(() => {
                timeLeft = generateDailyShop();
                updateShopTimerDisplay(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(shopTimerInterval);
                    showShop();
                }
            }, 1000);
            currentUser.dailyShopItems.forEach(item => {
                const modifier = Math.round(((item.price - item.originalPrice) / item.originalPrice) * 100);
                const modifierText = modifier !== 0 ? (modifier > 0 ? `+${modifier}%` : `${modifier}%`) : '';
                const discountText = modifier < 0 ?
                    `<span style="color:#f87171;text-decoration:line-through;margin-right:8px;">${item.originalPrice.toLocaleString()}</span>` :
                    '';
                const priceColor = modifier < 0 ? '#FFD700' : '#C0C0C0';

                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                <div class="item-header">
                    <h3>${item.name}</h3>
                    <p class="stock">Stock: <span id="stock-${item.code}">${item.stock}</span> (${modifierText})</p>
                </div>
                <p class="item-desc">${item.description}</p>
                <div class="item-footer">
                    <p class="price">${discountText} <span style="color:${priceColor};">${item.price.toLocaleString()}</span> points</p>
                    <button class="buy-btn menu-btn"
                            id="buy-${item.code}"
                            data-code="${item.code}"
                            data-price="${item.price}"
                            onclick="buyItem('${item.code}', ${item.price})">Acheter</button>
                </div>
            `;
                shopContainer.appendChild(itemDiv);
            });
            updateOwnedItemsDisplay();
            updateBuyButtons();
        }

        function updateOwnedItemsDisplay() {
            const ownedContainer = document.getElementById("ownedItemsList");
            ownedContainer.innerHTML = '';

            let found = false;
            Object.keys(currentUser.ownedItems).forEach(key => {
                const count = currentUser.ownedItems[key];
                if (count > 0) {
                    const name = SHOP_ITEMS[key][0];
                    const li = document.createElement('li');
                    li.innerHTML = `${name} : <strong>${count}</strong>`;
                    ownedContainer.appendChild(li);
                    found = true;
                }
            });
            if (!found) {
                ownedContainer.innerHTML = '<li>Inventaire vide.</li>';
            }
            document.getElementById("rerollCount").textContent = currentUser.ownedItems['DAILY_REROLL'];
            document.getElementById("hintCount").textContent = currentUser.ownedItems['HINT_TOKEN'];
        }

        function updateBuyButtons() {
            currentUser.dailyShopItems.forEach(item => {
                const button = document.getElementById(`buy-${item.code}`);
                if (button) {
                    button.disabled = item.stock <= 0 || currentUser.points < item.price;
                    button.textContent = item.stock <= 0 ? 'Stock √âpuis√©' : (currentUser.points < item.price ? 'Pas Assez de Points' : 'Acheter');
                }
            });
        }

        function buyItem(code, price) {
            if (currentUser.points < price) {
                alert("Vous n'avez pas assez de points !");
                return;
            }
            const shopItem = currentUser.dailyShopItems.find(item => item.code === code);
            if (!shopItem || shopItem.stock <= 0) {
                alert("Article √©puis√© ou non trouv√©.");
                if (shopItem.stock <= 0) {
                    updateBuyButtons();
                }
                return;
            }
            currentUser.points -= price;
            shopItem.stock--;
            currentUser.ownedItems[code] = (currentUser.ownedItems[code] || 0) + 1;

            // Mise √† jour des compteurs pour les succ√®s shop
            currentUser.shopItemsBoughtTotal++;
            currentUser.shopPointsSpent += price;
            if (currentUser.ownedItems['DAILY_REROLL'] > currentUser.dailyRerollsOwnedMax) {
                currentUser.dailyRerollsOwnedMax = currentUser.ownedItems['DAILY_REROLL'];
            }

            document.getElementById(`stock-${code}`).textContent = shopItem.stock;
            updateStats();
            updateOwnedItemsDisplay();
            updateBuyButtons();

            saveUser();

            showPopup("üí∞", "Achat R√©ussi !", `${SHOP_ITEMS[code][0]} achet√© pour ${price} points !`);
        }

        function useDailyReroll() {
            if (currentUser.ownedItems['DAILY_REROLL'] > 0) {
                if (!confirm("√ätes-vous s√ªr de vouloir consommer un Reroll pour rejouer au D√©fi du Jour ?")) return;
                currentUser.ownedItems['DAILY_REROLL']--;
                currentUser.dailyQuizLastPlayed = 0;
                saveUser();
                updateStats();
                showPopup("üîÑ", "Reroll Utilis√© !", "Le D√©fi du Jour est pr√™t √† √™tre rejou√© !");
                checkDailyQuizAvailability();
            } else {
                alert("Vous n'avez pas de ticket de r√©initialisation.");
            }
        }

       
        function checkDailyQuizAvailability() {
            clearTimeout(dailyTimerInterval);
            const e = Date.now(),
                t = currentUser.dailyQuizLastPlayed || 0,
                s = t + DAILY_COOLDOWN_MS,
                n = s - e,
                o = document.getElementById("dailyQuizBtn"),
                a = document.getElementById("dailyTimerDisplay");
            const c = document.getElementById("dailyQuizBtnContainer");

            return n <= 0 ? (a.style.display = "none", o.onclick = startDailyQuiz, o.classList.remove("disabled"), o.classList.add("play-button"), c.style.opacity = "1", o.textContent = "JOUER", "available") : (a.style.display = "block", o.onclick = null, o.classList.add("disabled"), c.style.opacity = ".6", o.textContent = "REVENIR PLUS TARD", updateDailyTimerDisplay(n), dailyTimerInterval = setInterval(() => {
                const e = s - Date.now();
                updateDailyTimerDisplay(e), e <= 0 && checkDailyQuizAvailability()
            }, 1e3), "unavailable")
        }

        function updateDailyTimerDisplay(e) {
            const t = document.getElementById("dailyTimerDisplay");
            if (e <= 0) return t.textContent = "", void checkDailyQuizAvailability();
            const s = Math.floor(e / 1e3),
                n = Math.floor(s / 3600),
                o = Math.floor(s % 3600 / 60),
                a = s % 60,
                i = String(n).padStart(2, "0"),
                c = String(o).padStart(2, "0"),
                r = String(a).padStart(2, "0");
            t.textContent = `Prochaine partie dans : ${i}h ${c}m ${r}s`
        }

        function startDailyQuiz() {
            return "unavailable" === checkDailyQuizAvailability() ? (alert("Le D√©fi du Jour n'est pas encore disponible."), void showMenu()) : (isInfiniteMode = !1, isChronoMode = !1, isQCMMode = !1, xpPerCorrect = 0,
                quiz = buildQuizForDifficulty([{
                    diff: 1,
                    count: 2
                }, {
                    diff: 2,
                    count: 2
                }, {
                    diff: 3,
                    count: 1
                }]),
                quiz.length < 5 && (quiz = quiz.concat(shuffleArray([...questions.filter(e => !quiz.includes(e))]).slice(0, 5 - quiz.length))),
                quiz.length !== 5 ? (alert("Erreur: Impossible de g√©n√©rer 5 questions pour le D√©fi du Jour."), void showMenu()) : void launchGame(0, "D√âFI DU JOUR (5 Q.) - Objectif 5/5 !", "daily"))
        }

        function buildQuizForDifficulty(e) {
            let t = [...questions],
                s = [];
            return e.forEach(e => {
                const n = t.filter(t => t.diff === e.diff);
                n.length < e.count ? s = s.concat(shuffleArray(n).slice(0, n.length)) : s = s.concat(shuffleArray(n).slice(0, e.count))
            }), shuffleArray(s)
        }

        // ================================================================
        // MODE QCM - VERSION CLASSIQUE (question + 4 choix A/B/C/D)
        // ================================================================
        function startQCM() {
            isInfiniteMode = false;
            isChronoMode = false;
            isQCMMode = true;
            xpPerCorrect = 10;
            quiz = shuffleArray([...qcmQuestions]).slice(0, 10);
            if (quiz.length < 5) {
                alert("Pas assez de questions QCM pour le moment. Ajoute-en plus !");
                showMenu();
                return;
            }
            launchGame(0, "Mode QCM (10 Questions - 4 Choix)", "qcm");
        }

        function launchGame(delay = 0, title, mode) {
            showScreen("game");
            current = 0;
            score = 0;
            clearTimeout(timer);
            document.getElementById("nextBtn").classList.add("hidden");
            document.getElementById("gameTitle").textContent = title;
            document.getElementById("game").setAttribute("data-mode", mode);
            const answersContainer = document.getElementById("answers");
            const hintBtn = document.getElementById("hintBtn");
            hintBtn.classList.add("hidden");
            if (isQCMMode) {
                answersContainer.innerHTML = `
                <button class="ans" id="ansA" data-index="0" onclick="answerQCM(this)">A</button>
                <button class="ans" id="ansB" data-index="1" onclick="answerQCM(this)">B</button>
                <button class="ans" id="ansC" data-index="2" onclick="answerQCM(this)">C</button>
                <button class="ans" id="ansD" data-index="3" onclick="answerQCM(this)">D</button>
            `;
                answersContainer.classList.add("qcm-style");
            } else {
                answersContainer.innerHTML = `<div class="ans vrai" onclick="answer(true)">VRAI</div><div class="ans faux" onclick="answer(false)">FAUX</div>`;
                answersContainer.classList.remove("qcm-style");
            }
            isChronoMode && delay > 0 ? (document.getElementById("timerContainer").classList.remove("hidden"), document.getElementById("timerContainer").setAttribute("data-time-limit", delay)) : document.getElementById("timerContainer").classList.add("hidden");
            document.getElementById("result").textContent = "";
            document.getElementById("exp").textContent = "";
            document.getElementById("levelUp").classList.add("hidden");
            document.getElementById("restartBtn").classList.add("hidden");
            answersContainer.querySelectorAll(".ans").forEach(e => e.classList.remove("disabled"));
            currentUser && currentUser.achievements[0] === 0 && (currentUser.achievements[0] = 1, document.getElementById("unlock"), showPopup("üë∂", "Succ√®s D√©bloqu√© !", "Premier pas : Jouer sa premi√®re partie"), saveUser());
            nextQuestion();
        }

        function nextQuestion() {
            clearTimeout(timer), isAnswered = !1,

                document.getElementById("timerFill").style.transition = "none";
            document.getElementById("timerFill").style.width = "100%";

            document.getElementById("result").textContent = "", document.getElementById("exp").textContent = "", document.getElementById("nextBtn").classList.add("hidden"), document.getElementById("levelup").classList.add("hidden"), document.getElementById("restartBtn").classList.add("hidden");

            const hintBtn = document.getElementById("hintBtn");
            const mode = document.getElementById("game").getAttribute("data-mode");
            if (isQCMMode || mode === 'daily' || isInfiniteMode || currentUser.ownedItems['HINT_TOKEN'] === 0) {
                hintBtn.classList.add("hidden");
            } else {
                hintBtn.classList.remove("hidden");
            }

            const answersContainer = document.getElementById("answers");
            answersContainer.querySelectorAll(".ans").forEach(e => {
                e.classList.remove("disabled", "vrai", "faux");
                e.style.backgroundColor = '';
                e.style.boxShadow = '0 12px 35px rgba(0,0,0,0.5)';
                e.disabled = false;
            });

            let e;
            const t = document.getElementById("game").getAttribute("data-mode");

            if ("infinite" === t) {
                if (current >= quiz.length) {
                    quiz = shuffleArray([...questions]);
                    current = 0;
                }
                e = quiz[current];
                document.getElementById("q").innerHTML = `Score actuel: **${score}**<br>${e.q}`;
                document.getElementById("gameProgress").textContent = "";
            } else if ("daily" === t || "chrono" === t || "classic" === t) {
                if (current < quiz.length) {
                    e = quiz[current];
                    document.getElementById("gameProgress").textContent = `Question ${current+1}/${quiz.length}`;
                    document.getElementById("q").innerHTML = isQCMMode ? e.question : e.q;
                } else {
                    return endQuiz();
                }
            } else if (isQCMMode) {
                if (current < quiz.length) {
                    e = quiz[current];
                    document.getElementById("gameProgress").textContent = `Question ${current+1}/${quiz.length}`;
                    document.getElementById("q").innerHTML = e.question;
                    const labels = ["A", "B", "C", "D"];
                    e.options.forEach((option, index) => {
                        const btn = document.getElementById(`ans${labels[index]}`);
                        btn.textContent = `${labels[index]}) ${option}`;
                        btn.dataset.index = index;
                    });
                } else {
                    return endQuiz();
                }
            }
            current++, isChronoMode && startTimer()
        }

     function useHint() {
    if (isAnswered) return;
    if (currentUser.ownedItems['HINT_TOKEN'] <= 0) {
        alert("Vous n'avez pas d'indice ! Achetez-en au Shop.");
        return;
    }

    const currentQuestion = quiz[current - 1];
    if (!currentQuestion) return;

    const correct = currentQuestion.a;
    const correctAns = correct ? "VRAI" : "FAUX";

    if (confirm(`Utiliser un indice pour r√©v√©ler la bonne r√©ponse ? (Restants : ${currentUser.ownedItems['HINT_TOKEN']})`)) {
        // Consomme l'indice
        currentUser.ownedItems['HINT_TOKEN']--;

        // Bloque imm√©diatement
        isAnswered = true;
        clearTimeout(timer);

        // Grise et bloque boutons
        const answers = document.getElementById("answers");
        answers.querySelectorAll(".ans").forEach(btn => {
            btn.disabled = true;
            btn.classList.add("disabled");
            btn.style.pointerEvents = "none";
            btn.style.opacity = "0.6";
        });

        // Montre la bonne r√©ponse en vert
        answers.querySelectorAll(".ans").forEach(btn => {
            if (btn.textContent.trim().toUpperCase().includes(correctAns)) {
                btn.style.backgroundColor = '#388E3C';
                btn.style.boxShadow = '0 12px 35px rgba(56, 142, 60, 0.7)';
            }
        });

        // Affiche r√©sultat + explication (sans popup)
        document.getElementById("result").style.color = "#388E3C";
        document.getElementById("result").textContent = "‚úî Indice utilis√© !";
        document.getElementById("exp").innerHTML = `R√©ponse : <strong>${correctAns}</strong><br>${currentQuestion.e}`;

        // Donne XP et streak
        let xpGain = xpPerCorrect;
        if (currentUser.ownedItems['XP_BOOST_X2'] > 0) xpGain *= 2;
        currentUser.xp += xpGain;
        currentUser.totalXp += xpGain;
        currentUser.points += 10;
        currentUser.streak++;
        if (currentUser.streak > currentUser.best) currentUser.best = currentUser.streak;

        document.getElementById("exp").innerHTML += `<br>+${xpGain} XP ! (S√©rie : ${currentUser.streak})`;

        // Met √† jour bouton indice
        document.getElementById("hintBtn").textContent = `Utiliser Indice (${currentUser.ownedItems['HINT_TOKEN']})`;

        // Sauvegarde tout
        saveUser();
        updateStats();

        // Passage imm√©diat √† la question suivante (sans d√©lai ni popup)
        // On reset juste avant pour √©viter tout blocage
        setTimeout(() => {
            isAnswered = false;
            clearTimeout(timer);

            // R√©active boutons manuellement
            const ansBtns = document.getElementById("answers").querySelectorAll(".ans");
            ansBtns.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove("disabled");
                btn.style.pointerEvents = "auto";
                btn.style.opacity = "1";
                btn.style.backgroundColor = '';
                btn.style.boxShadow = '0 12px 35px rgba(0,0,0,0.5)';
            });

            // Reset timer visuel
            const fill = document.getElementById("timerFill");
            if (fill) {
                fill.style.transition = "none";
                fill.style.width = "100%";
            }
            const timerText = document.getElementById("timerText");
            if (timerText) {
                timerText.style.animation = "none";
                timerText.style.color = "#388E3C";
            }

            nextQuestion();
        }, 1500);  // Petit d√©lai de 1.5s pour que le joueur voie la bonne r√©ponse + explication
    }
}
        function startTimer() {
            const timeLimit = parseInt(document.getElementById("timerContainer").getAttribute("data-time-limit")) || 10000;
            let remaining = Math.ceil(timeLimit / 1000);

            const fill = document.getElementById("timerFill");
            const text = document.getElementById("timerText");

            // Reset total avant tout
            fill.style.transition = "none";
            fill.style.width = "100%";
            text.textContent = `${remaining}s`;
            text.style.color = "#388E3C";
            text.style.animation = "none";

            // Forcer reflow (important pour CSS)
            void fill.offsetWidth;

            // Lancement animation
            fill.style.transition = `width ${timeLimit}ms linear`;
            fill.style.width = "0%";

            const tick = () => {
                remaining--;
                text.textContent = `${remaining}s`;

                // Clignotement urgence < 4s
                if (remaining <= 3) {
                    text.style.color = "#ff4444";
                    text.style.animation = "pulse 0.8s infinite alternate";
                }

                if (remaining <= 0) {
                    if (!isAnswered) {
                        isAnswered = true;
                        fill.style.transition = "none";
                        fill.style.width = "0%";
                        document.getElementById("timeout").play();
                        processAnswer(false, true); // timeout = faux
                    }
                    return;
                }

                timer = setTimeout(tick, 1000);
            };

            timer = setTimeout(tick, 1000);
        }

        function answer(e) {
            if (isAnswered) return;
            isAnswered = !0, clearTimeout(timer);
            const fill = document.getElementById("timerFill");
            fill.style.transition = "none";
            fill.style.width = "100%";
            document.getElementById("timerText").style.animation = "none";
            document.getElementById("timerText").style.color = "#388E3C";
            fill.style.transition = "none";
            fill.style.width = "100%";
            document.getElementById("timerFill").style.transition = "none", processAnswer(e, !1)
        }

        function answerQCM(btn) {
            if (isAnswered) return;
            isAnswered = true;
            clearTimeout(timer);
            const fill = document.getElementById("timerFill");
            fill.style.transition = "none";
            fill.style.width = "100%";
            document.getElementById("timerText").style.animation = "none";
            document.getElementById("timerText").style.color = "#388E3C";
            const selectedIndex = parseInt(btn.dataset.index);
            const currentQ = quiz[current - 1];
            const isCorrect = selectedIndex === currentQ.correctIndex;
            document.getElementById("answers").querySelectorAll(".ans").forEach(b => {
                b.disabled = true;
                b.classList.add("disabled");
                const idx = parseInt(b.dataset.index);
                if (idx === currentQ.correctIndex) {
                    b.style.backgroundColor = '#388E3C';
                    b.style.boxShadow = '0 12px 35px rgba(56, 142, 60, 0.7)';
                } else if (idx === selectedIndex && !isCorrect) {
                    b.style.backgroundColor = '#D32F2F';
                    b.style.boxShadow = '0 12px 35px rgba(211, 47, 47, 0.7)';
                }
            });
            processAnswerQCM(isCorrect);
        }

        function processAnswerQCM(isCorrect) {
            if (!currentUser) return;
            currentUser.totalQuestions++;
            const q = quiz[current - 1];
            if (isCorrect) {
                document.getElementById("good").play();
                document.getElementById("result").style.color = "#388E3C";
                document.getElementById("result").textContent = "‚úî Correct !";
                score++;
                currentUser.totalCorrect++;
                currentUser.streak++;
                if (currentUser.streak > currentUser.best) currentUser.best = currentUser.streak;
                let xpGain = xpPerCorrect;
                if (currentUser.ownedItems['XP_BOOST_X2'] > 0) xpGain *= 2;
                currentUser.xp += xpGain;
                currentUser.totalXp += xpGain;
                currentUser.points += 10;
                document.getElementById("exp").innerHTML = `+${xpGain} XP ! (+10 Points) (S√©rie : ${currentUser.streak})`;
            } else {
                document.getElementById("bad").play();
                document.getElementById("result").style.color = "#D32F2F";
                document.getElementById("result").textContent = "‚ùå Faux !";
                document.getElementById("exp").textContent = `Explication : ${q.explanation}`;
                currentUser.streak = 0;
                const penalty = Math.ceil(xpPerCorrect / 2);
                currentUser.xp = Math.max(0, currentUser.xp - penalty);
                currentUser.totalXp = Math.max(0, currentUser.totalXp - penalty);
                document.getElementById("exp").textContent += ` | ‚ö†Ô∏è -${penalty} XP de p√©nalit√© !`;
            }
            updateStats();
            saveUser();
            if (current < quiz.length) {
                setTimeout(nextQuestion, NEXT_QUESTION_DELAY);
            } else {
                endQuiz();
            }
        }

        function processAnswer(e, t) {
            if (!currentUser) return;
            const s = current - 1,
                n = quiz[s],
                o = n.a;
            currentUser.totalQuestions++;
            const a = document.getElementById("game").getAttribute("data-mode"),
                i = "daily" === a,
                c = t ? !1 : e === o;
            document.getElementById("answers").querySelectorAll(".ans").forEach(btn => {
                btn.classList.add("disabled");
                if (btn.textContent.includes(o ? 'VRAI' : 'FAUX')) {
                    btn.style.backgroundColor = '#388E3C';
                    btn.style.boxShadow = '0 12px 35px rgba(56, 142, 60, 0.7)';
                } else if (btn.textContent.includes(e ? 'VRAI' : 'FAUX') && !c) {
                    btn.style.backgroundColor = '#D32F2F';
                    btn.style.boxShadow = '0 12px 35px rgba(211, 47, 47, 0.7)';
                }
            });

            document.getElementById("hintBtn").classList.add("hidden");

            if (c) {
                document.getElementById("good"), document.getElementById("result").style.color = "#388E3C", document.getElementById("result").textContent = "‚úî Correct !", score++, currentUser.totalCorrect++, currentUser.streak++, currentUser.streak > currentUser.best && (currentUser.best = currentUser.streak);
                if (!i) {
                    (e => {
                        let t = e;
                        isInfiniteMode || (t += Math.floor(currentUser.streak / 5));

                        if (currentUser.ownedItems['XP_BOOST_X2'] > 0) t *= 2;
                        currentUser.xp += t, currentUser.totalXp += t;
                        if (!isInfiniteMode) currentUser.points += 10;
                        else currentUser.points += Math.max(1, Math.floor(t / 2));
                        document.getElementById("exp").innerHTML = `+${t} XP ! (+${!isInfiniteMode ? 10 : Math.max(1, Math.floor(t/2))} Points) (S√©rie : ${currentUser.streak})`;
                        updateStats();
                    })(xpPerCorrect);
                }
                i && ((document.getElementById("exp").innerHTML = `Bonne r√©ponse ! (S√©rie : ${currentUser.streak})`), !0);
            } else {
                t || document.getElementById("bad"), document.getElementById("result").style.color = "#D32F2F", document.getElementById("result").textContent = t && isChronoMode ? "‚ùå Temps √©coul√© !" : "‚ùå Faux !", document.getElementById("exp").textContent = `Explication: ${n.e}`;

                if ("infinite" === a && currentUser.ownedItems['INFINITE_REVIVE'] > 0) {
                    currentUser.ownedItems['INFINITE_REVIVE']--;
                    document.getElementById("unlock").play();
                    document.getElementById("result").textContent = "‚ùå Faux ! | REVIVE UTILIS√â !";
                    document.getElementById("exp").textContent = `Explication: ${n.e} | REVIVE UTILIS√â ! (${currentUser.ownedItems['INFINITE_REVIVE']} restants)`;

                    current++;
                    setTimeout(() => {
                        nextQuestion()
                    }, NEXT_QUESTION_DELAY);
                    saveUser();
                    updateStats();
                    return;
                }

                i || (e => {
                    const t = Math.ceil(e / 2);
                    if (currentUser.xp -= t, currentUser.totalXp = Math.max(0, currentUser.totalXp - t), currentUser.xp < 0) {
                        currentUser.xp = 0;
                    }
                    document.getElementById("exp").textContent += ` | ‚ö†Ô∏è -${t} XP de p√©nalit√© !`;
                })(xpPerCorrect);

                currentUser.streak = 0, document.getElementById("exp").textContent += ` | S√©rie interrompue.`;
            }

            if (c && ("infinite" === a || current < quiz.length)) {
                setTimeout(() => {
                    nextQuestion()
                }, NEXT_QUESTION_DELAY);
            } else if (!c && "infinite" === a) {
                endQuiz();
            } else if (current < quiz.length) {
                setTimeout(() => {
                    nextQuestion()
                }, NEXT_QUESTION_DELAY);
            } else {
                endQuiz();
            }
            saveUser(), updateStats();
        }

        function endQuiz() {
            clearTimeout(timer);
            const e = document.getElementById("game").getAttribute("data-mode"),
                t = "daily" === e,
                s = "qcm" === e;
            document.getElementById("q").textContent = "Partie termin√©e !", document.getElementById("result").style.color = "#FFD700", document.getElementById("result").textContent = `Ton score: ${score} / ${quiz.length}`;

            const isFiniteMode = !isInfiniteMode;
            if (isFiniteMode && currentUser.ownedItems['XP_BOOST_X2'] > 0) {
                if (e === 'classic' || e === 'chrono' || e === 'qcm') {
                    currentUser.ownedItems['XP_BOOST_X2']--;
                    alert(`Boost XP x2 consomm√© ! ${currentUser.ownedItems['XP_BOOST_X2']} charge(s) restante(s).`);
                }
            }

            if (s) {
                totalQCMCompleted++;
                if (score === quiz.length) {
                    currentUser.qcmPerfects++;
                    if (0 === currentUser.achievements[11]) {
                        currentUser.achievements[11] = 1;
                        document.getElementById("unlock").play();
                        showPopup("‚úÖ", "Succ√®s D√©bloqu√© !", "Ma√Ætre QCM : 10/10 parfait en mode QCM");
                    }
                }
                document.getElementById("exp").textContent = "Bravo pour cette partie QCM. Retourne au menu pour voir tes stats !";
                if (totalQCMCompleted >= 5 && currentUser.achievements[9] === 0) {
                    currentUser.achievements[9] = 1;
                    document.getElementById("unlock").play();
                    showPopup("üß†", "Succ√®s D√©bloqu√© !", "QCM Initi√© : Terminer 5 parties QCM");
                }
            } else if (t) {
                currentUser.dailyQuizLastPlayed = Date.now();
                currentUser.dailyQuizzesCompleted++;
                if (5 === score) {
                    currentUser.xp += 200, currentUser.totalXp += 200;
                    document.getElementById("exp").innerHTML = "üéâ **F√âLICITATIONS !** Tu as fait un 5/5 !<br>+200 XP de bonus quotidien !";
                } else {
                    document.getElementById("exp").textContent = "Dommage ! Il te fallait un 5/5 pour le bonus de 200 XP quotidien. Reviens demain !";
                }
            } else if (e === "infinite") {
                if (score > currentUser.infiniteBest) {
                    currentUser.infiniteBest = score;
                    document.getElementById("exp").textContent = `Nouveau record Infini : ${score} !`;
                    if (score >= 50 && currentUser.achievements[3] === 0) {
                        currentUser.achievements[3] = 1;
                        document.getElementById("unlock").play();
                        showPopup("‚ôæÔ∏è", "Succ√®s D√©bloqu√© !", "Infini 50 : Atteindre 50 points en Mode Infini");
                    }
                } else {
                    document.getElementById("exp").textContent = `Record Infini : ${currentUser.best}.`;
                }
            } else if (e === "chrono") {
                currentUser.chronoGamesPlayed++;
                if (score === quiz.length) {
                    currentUser.chronoPerfects++;
                }
            } else if (score === quiz.length && quiz.length > 0) {
                document.getElementById("exp").textContent = "Tu as gagn√© de l'XP dans cette partie. Retourne au menu pour voir tes stats !";
                const t = document.getElementById("gameTitle").textContent,
                    n = document.getElementById("timerContainer").getAttribute("data-time-limit"),
                    o = n && parseInt(n) > 0;
                t.includes("Classique : Difficile") && 0 === currentUser.achievements[8] && (currentUser.achievements[8] = 1, document.getElementById("unlock").play(), showPopup("üìø", "Succ√®s D√©bloqu√© !", "Hafiz : 10/10 en Difficult√© Difficile")),
                    o && 0 === currentUser.achievements[4] && (currentUser.achievements[4] = 1, document.getElementById("unlock").play(), showPopup("‚è±Ô∏è", "Succ√®s D√©bloqu√© !", "Vitesse √âclair : Finir le Mode Chrono sans erreur")),
                    !o && !t.includes("Classique : Difficile") && 0 === currentUser.achievements[1] && (currentUser.achievements[1] = 1, document.getElementById("unlock").play(), showPopup("üíØ", "Succ√®s D√©bloqu√© !", "10/10 Parfait ! : Faire un sans-faute en Classique"));
            } else {
                document.getElementById("exp").textContent = "Tu as gagn√© de l'XP dans cette partie. Retourne au menu pour voir tes stats !";
            }
            currentUser.streak = 0, saveUser(), document.getElementById("restartBtn").classList.remove("hidden"), document.getElementById("nextBtn").classList.add("hidden"), document.getElementById("timerContainer").classList.add("hidden"), updateStats()
        }

        function checkAchievements() {
            if (!currentUser) return;

            const goals = [{
                    id: "a1",
                    goal: 1,
                    current: currentUser.totalQuestions > 0 ? 1 : 0,
                    text: "Jouer sa premi√®re partie",
                    idx: 0
                },
                {
                    id: "a2",
                    goal: 1,
                    current: currentUser.achievements[1],
                    text: "Faire un sans-faute en Classique",
                    idx: 1
                },
                {
                    id: "a3",
                    goal: 10,
                    current: currentUser.best > 10 ? 10 : currentUser.streak,
                    text: "Faire 10 bonnes r√©ponses d‚Äôaffil√©e",
                    idx: 2
                },
                {
                    id: "a4",
                    goal: 50,
                    current: currentUser.best,
                    text: "Atteindre 50 points en Mode Infini",
                    idx: 3
                },
                {
                    id: "a5",
                    goal: 1,
                    current: currentUser.achievements[4],
                    text: "Finir le Mode Chrono sans erreur",
                    idx: 4
                },
                {
                    id: "a6",
                    goal: 1e3,
                    current: Math.round(currentUser.totalXp),
                    text: "Gagner 1000 XP au total",
                    idx: 5
                },
                {
                    id: "a7",
                    goal: 500,
                    current: currentUser.totalCorrect,
                    text: "500 bonnes r√©ponses",
                    idx: 6
                },
                {
                    id: "a8",
                    goal: 1e3,
                    current: currentUser.totalQuestions,
                    text: "1000 questions r√©pondues",
                    idx: 7
                },
                {
                    id: "a9",
                    goal: 1,
                    current: currentUser.achievements[8],
                    text: "10/10 en Difficult√© Difficile",
                    idx: 8
                },
                {
                    id: "a11",
                    goal: 5,
                    current: totalQCMCompleted,
                    text: "Terminer 5 parties QCM",
                    idx: 9
                },
                {
                    id: "a12",
                    goal: 1,
                    current: currentUser.achievements[11],
                    text: "Faire un 10/10 parfait en mode QCM",
                    idx: 11
                },
                {
                    id: "a10",
                    goal: 1,
                    current: currentUser.achievements.slice(0, 9).every(e => 1 === e) && currentUser.achievements[9] === 1 && currentUser.achievements[11] === 1 ? 1 : 0,
                    text: "Tous les succ√®s d√©bloqu√©s",
                    idx: 10
                },

                // === AJOUT DES NOUVEAUX SUCC√àS ===
                {
                    id: "a13",
                    goal: 10,
                    current: currentUser.chronoGamesPlayed,
                    text: "10 parties Mode Chrono",
                    idx: 12
                },
                {
                    id: "a14",
                    goal: 3,
                    current: currentUser.chronoPerfects,
                    text: "3 √ó 10/10 en Mode Chrono",
                    idx: 13
                },
                {
                    id: "a15",
                    goal: 25,
                    current: currentUser.infiniteBest,
                    text: "Score 25 en Mode Infini",
                    idx: 14
                },
                {
                    id: "a16",
                    goal: 5,
                    current: currentUser.qcmPerfects,
                    text: "5 √ó 10/10 en Mode QCM",
                    idx: 15
                },
                {
                    id: "a17",
                    goal: 1,
                    current: Object.keys(SHOP_ITEMS).every(k => currentUser.ownedItems[k] > 0) ? 1 : 0,
                    text: "Acheter tous les types d'objets du shop",
                    idx: 16
                },
                {
                    id: "a18",
                    goal: 10000,
                    current: currentUser.shopPointsSpent,
                    text: "D√©penser 10 000 points boutique",
                    idx: 17
                },
                {
                    id: "a19",
                    goal: 50000,
                    current: currentUser.points,
                    text: "Avoir 50 000 points boutique",
                    idx: 18
                },
                {
                    id: "a20",
                    goal: 1,
                    current: (currentUser.achievements[1] && currentUser.achievements[8] && currentUser.achievements[2]) ? 1 : 0,
                    text: "10/10 dans Facile, Normal ET Difficile",
                    idx: 19
                },
                {
                    id: "a21",
                    goal: 1,
                    current: getLeaderboardData().slice(0, 3).some(p => p.pseudo === currentUser.pseudo) ? 1 : 0,
                    text: "√ätre dans le top 3 du classement",
                    idx: 20
                },
                {
                    id: "a22",
                    goal: 1,
                    current: getLeaderboardData()[0]?.pseudo === currentUser.pseudo ? 1 : 0,
                    text: "√ätre num√©ro 1 du classement",
                    idx: 21
                },
                {
                    id: "a23",
                    goal: 5,
                    current: currentUser.dailyQuizzesCompleted,
                    text: "Terminer 5 d√©fis du jour",
                    idx: 22
                },
                {
                    id: "a24",
                    goal: 3,
                    current: 0,
                    text: "3 d√©fis du jour dans la m√™me journ√©e (non impl√©ment√©)",
                    idx: 23
                }, // √Ä impl√©menter si suivi par jour
                {
                    id: "a25",
                    goal: 5,
                    current: currentUser.dailyRerollsOwnedMax,
                    text: "Avoir poss√©d√© 5 Daily Rerolls en m√™me temps",
                    idx: 24
                }
            ];

            goals.forEach((e, t) => {
                    const s = document.getElementById(e.id),
                        o = document.getElementById(e.id).querySelector("div");
                    const originalTitle = o.querySelector("strong").textContent;

                    if (e.current >= e.goal) {
                        s.classList.add("unlocked"), o.innerHTML = `<strong>${originalTitle}</strong><br>‚úÖ D√©bloqu√© !`;

                        if (0 === currentUser.achievements[e.idx]) {
                            currentUser.achievements[e.idx] = 1;
                            document.getElementById("unlock").play();
                            showPopup("üèÜ", "Succ√®s D√©bloqu√© !", e.text);
                        }
                    } else {
                        s.classList.remove("unlocked");

                        let t = e.goal - e.current;
                        let a = e.current;
                        let i = e.goal;
                        let c = "";

                        o.innerHTML = `<strong>${originalTitle}</strong><br><span id="${e.id}-prog"></span>`;
                        const n = document.getElementById(`${e.id}-prog`);

                        if ("a1" === e.id) {
                            n.textContent = "Jouer ta premi√®re partie"
                        } else if ("a2" === e.id || "a5" === e.id || "a9" === e.id || "a12" === e.id || "a10" === e.id) {
                            n.textContent = e.text
                        } else {
                            if ("a3" === e.id) {
                                a = currentUser.streak;
                                c = "üëç Bonnes R√©ponses";
                            } else if ("a4" === e.id) {
                                a = currentUser.best;
                                c = " Points Infini";
                            } else if ("a6" === e.id) {
                                c = " XP";
                            } else if ("a7" === e.id) {
                                c = " Bonnes R√©ponses";
                            } else if ("a8" === e.id) {
                                c = " Questions";
                            } else if ("a11" === e.id) {
                                a = totalQCMCompleted;
                                c = " Parties termin√©es";
                            } else if ("a13" === e.id) {
                                c = " parties Chrono";
                            } else if ("a14" === e.id) {
                                c = " √ó 10/10 Chrono";
                            } else if ("a15" === e.id) {
                                c = " points Infini (meilleur score)";
                            } else if ("a16" === e.id) {
                                c = " √ó 10/10 QCM";
                            } else if ("a17" === e.id) {
                                c = " types d'objets achet√©s";
                            } else if ("a18" === e.id) {
                                c = " points d√©pens√©s";
                            } else if ("a19" === e.id) {
                                c = " points boutique poss√©d√©s";
                            } else if ("a20" === e.id) {
                                n.textContent = e.text;
                            } else if ("a21" === e.id || "a22" === e.id) {
                                n.textContent = e.text;
                            } else if ("a23" === e.id) {
                                c = " d√©fis du jour termin√©s";
                            } else if ("a24" === e.id) {
                                n.textContent = e.text;
                            } else if ("a25" === e.id) {
                                c = " rerolls max poss√©d√©s";
                            }

                            let r = i - a;
                            if (r < 0) r = 0;

                            if (n.textContent === "") n.textContent = `${Math.round(a).toLocaleString()}/${i.toLocaleString()}${c} (${Math.round(r).toLocaleString()} restants)`
                        }
                    }
                }),

                currentUser.achievements.slice(0, 9).every(e => 1 === e) && currentUser.achievements[9] === 1 && currentUser.achievements[11] === 1 && 0 === currentUser.achievements[10] && (currentUser.achievements[10] = 1, document.getElementById("unlock").play(), showPopup("üíé", "F√âLICITATIONS !", "L√©gende de la oumma : Tous les succ√®s d√©bloqu√©s")), saveUser()
        }

        function startRamadanCountdown() {
            const ramadanStart = new Date('2026-02-18T00:00:00');

            function updateCountdown() {
                const now = new Date();
                const diff = ramadanStart - now;

                if (diff <= 0) {
                    document.getElementById('countdownTimer').textContent = "Ramadan a commenc√© ! Ramadan Mubarak üåô";
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                let text = "";
                if (days > 0) {
                    text = `${days} jour${days > 1 ? 's' : ''} ${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                } else if (hours > 0) {
                    text = `${hours}h ${minutes.toString().padStart(2,'0')}min ${seconds.toString().padStart(2,'0')}s`;
                } else {
                    text = `${minutes}min ${seconds.toString().padStart(2,'0')}s`;
                }

                document.getElementById('countdownTimer').textContent = text;
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        function startClassic(e) {
            isInfiniteMode = !1, isChronoMode = !1, isQCMMode = !1;
            let t = 0,
                s, n;
            if (1 === e) xpPerCorrect = 1, s = [{
                diff: 1,
                count: 10
            }], n = "Classique : Facile (1 XP/Q)";
            else if (2 === e) xpPerCorrect = 10, s = [{
                diff: 1,
                count: 5
            }, {
                diff: 2,
                count: 5
            }], n = "Classique : Normal (10 XP/Q)";
            else {
                if (3 !== e) return;
                xpPerCorrect = 15, s = [{
                    diff: 2,
                    count: 5
                }, {
                    diff: 3,
                    count: 5
                }], n = "Classique : Difficile (15 XP/Q)"
            }
            const o = 1e3 * t;
            quiz = buildQuizForDifficulty(s), launchGame(o, n, "classic")
        }

        function startChrono() {
            isInfiniteMode = !1, isChronoMode = !0, isQCMMode = !1, xpPerCorrect = 10;
            const e = 1e4,
                t = [{
                    diff: 1,
                    count: 5
                }, {
                    diff: 2,
                    count: 5
                }];
            quiz = buildQuizForDifficulty(t), launchGame(e, "Mode Chrono (10 Q. - 10s/Q)", "chrono")
        }

        function startInfinite() {
            isInfiniteMode = !0, isChronoMode = !1, isQCMMode = !1, xpPerCorrect = 10, quiz = shuffleArray([...questions]), launchGame(0, "Mode Infini : 1 Faute = Perdu", "infinite")
        }
       // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//     CALENDRIER CADEAUX RAMADAN v4.1 ‚Äì commence 30 jours avant
//     - Visible √† partir du 30e jour avant Ramadan
//     - Rattrapage possible sur les jours pass√©s
//     - Futur bloqu√©
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const RAMADAN_START_2026 = new Date(2026, 1, 18); // 18 f√©vrier 2026
const DAYS_BEFORE_VISIBLE = 30;
const START_VISIBLE_DATE = new Date(RAMADAN_START_2026);
START_VISIBLE_DATE.setDate(RAMADAN_START_2026.getDate() - DAYS_BEFORE_VISIBLE);

function getDayIndex(date) {
    const diff = date - START_VISIBLE_DATE;
    return Math.floor(diff / 86400000);
}

function isPast(date) {
    return date < new Date().setHours(0,0,0,0);
}

function isToday(date) {
    const today = new Date();
    return date.getFullYear() === today.getFullYear() &&
           date.getMonth() === today.getMonth() &&
           date.getDate() === today.getDate();
}

function isFuture(date) {
    return date > new Date().setHours(0,0,0,0);
}

function hasClaimedDay(dayIndex) {
    const claimed = JSON.parse(localStorage.getItem('ramadanClaimedDays') || '[]');
    return claimed.includes(dayIndex);
}

function markDayClaimed(dayIndex) {
    let claimed = JSON.parse(localStorage.getItem('ramadanClaimedDays') || '[]');
    if (!claimed.includes(dayIndex)) {
        claimed.push(dayIndex);
        localStorage.setItem('ramadanClaimedDays', JSON.stringify(claimed));
    }
}

function getRewardForDay(dayIndex) {
    // Plus on est proche ‚Üí plus la r√©compense est grosse
    let baseXP = 50 + Math.max(0, DAYS_BEFORE_VISIBLE - dayIndex) * 6;
    let basePoints = 30 + Math.max(0, DAYS_BEFORE_VISIBLE - dayIndex) * 4;

    const daysLeft = Math.max(0, Math.ceil((RAMADAN_START_2026 - new Date()) / 86400000));

    if (daysLeft <= 7)  { baseXP = Math.round(baseXP * 2.5); basePoints *= 2.2; }
    if (daysLeft <= 3)  { baseXP = Math.round(baseXP * 1.6); basePoints = Math.round(basePoints * 1.5); }

    return { xp: baseXP, points: basePoints };
}

function showRamadanGiftPopup() {
    const popup = document.getElementById('ramadanGiftPopup');
    const daysLeftEl = document.getElementById('giftDaysLeft');
    const rewardEl = document.getElementById('selectedDayReward');
    const grid = document.getElementById('ramadanCalendarGrid');
    const claimBtn = document.getElementById('claimSelectedDayBtn');

    const now = new Date();
    const daysLeft = Math.max(0, Math.ceil((RAMADAN_START_2026 - now) / 86400000));
    daysLeftEl.textContent = daysLeft <= 0 
        ? "Ramadan 2026 est arriv√© ! üåô" 
        : `Plus que ${daysLeft} jour${daysLeft > 1 ? 's' : ''} ‚Ä¢ Commence le ${START_VISIBLE_DATE.toLocaleDateString('fr-FR')}`;

    grid.innerHTML = '';

    // On commence exactement 30 jours avant
    const start = new Date(START_VISIBLE_DATE);
    const totalDaysToShow = daysLeft + 5; // +5 jours apr√®s pour le futur proche

    for (let i = 0; i < totalDaysToShow; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);

        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        dayDiv.textContent = d.getDate();

        const dayIndex = getDayIndex(d);

        // Style selon statut
        if (isToday(d)) {
            dayDiv.classList.add('today');
            dayDiv.title = "Aujourd'hui ‚Äì clique pour r√©clamer";
        } else if (isPast(d)) {
            dayDiv.classList.add('past');
            dayDiv.title = "Jour pass√© ‚Äì rattrapable";
        } else {
            dayDiv.classList.add('future');
            dayDiv.style.opacity = '0.55';
            dayDiv.style.cursor = 'not-allowed';
            dayDiv.title = "Jour futur ‚Äì pas encore disponible";
        }

        if (d >= RAMADAN_START_2026) {
            dayDiv.style.background = 'linear-gradient(135deg, #FFD70040, #FFAA0040)';
        }

        // D√©j√† claim√© ?
        if (hasClaimedDay(dayIndex)) {
            dayDiv.innerHTML += ' ‚úì';
            dayDiv.style.opacity = '0.75';
            dayDiv.style.background = 'rgba(50,205,50,0.25)';
        }

        // Clic sur la case
        dayDiv.onclick = () => {
            if (isFuture(d)) {
                rewardEl.textContent = "Pas encore arriv√©... patience akhi üåô";
                claimBtn.disabled = true;
                claimBtn.textContent = "Jour futur";
                return;
            }

            const reward = getRewardForDay(dayIndex);
            rewardEl.innerHTML = `Jour du ${d.toLocaleDateString('fr-FR')} :\n` +
                                 `+${reward.xp} XP\n` +
                                 `+${reward.points} points boutique`;

            claimBtn.disabled = hasClaimedDay(dayIndex);
            claimBtn.textContent = hasClaimedDay(dayIndex) ? "D√©j√† r√©clam√© ‚úì" : "Claim cette r√©compense";

            if (!hasClaimedDay(dayIndex)) {
                claimBtn.onclick = () => {
                    if (!currentUser) {
                        alert("Connecte-toi pour r√©clamer !");
                        return;
                    }

                    currentUser.xp += reward.xp;
                    currentUser.totalXp += reward.xp;
                    currentUser.points += reward.points;
                    saveUser();
                    updateStats();

                    markDayClaimed(dayIndex);
                    dayDiv.innerHTML += ' ‚úì';
                    dayDiv.style.background = 'rgba(50,205,50,0.3)';

                    showPopup('üåüüéÅ', 'Alhamdulillah !', 
                        `R√©compense du ${d.toLocaleDateString('fr-FR')} r√©clam√©e !\n\n` +
                        `+${reward.xp} XP\n+${reward.points} points boutique`);

                    rewardEl.textContent = "R√©compense r√©clam√©e ‚úì";
                    claimBtn.disabled = true;
                    claimBtn.textContent = "D√©j√† r√©clam√©";
                };
            }
        };

        grid.appendChild(dayDiv);
    }

    rewardEl.textContent = "Clique sur une case pour voir / r√©clamer la r√©compense";
    claimBtn.disabled = true;
    claimBtn.textContent = "Choisis un jour";

    popup.classList.add('show');
}

// Initialisation du bouton
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('ramadanGiftBtn');
    if (btn) btn.onclick = showRamadanGiftPopup;
});
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CLASSEMENT AVEC MENU D√âROULANT DANS L'EN-T√äTE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

let currentCategory = 'totalXp';

function toggleCategoryList() {
    const list = document.getElementById('categoryList');
    list.style.display = list.style.display === 'none' ? 'block' : 'none';
}

function selectCategory(category) {
    currentCategory = category;
    
    // Met √† jour le texte du bouton
    document.getElementById('currentCategoryBtn').firstChild.nodeValue = 
        (category === 'totalXp' ? 'Total XP' :
         category === 'infiniteBest' ? 'Meilleur Infini' :
         'Points Boutique') + ' ‚ñº';

    // Recharge le tableau
    loadLeaderboard(category);

    // Ferme la liste
    document.getElementById('categoryList').style.display = 'none';
}

function loadLeaderboard(category = 'totalXp') {
    const tbody = document.getElementById('leaderboardBody');
    tbody.innerHTML = '';

    const data = getLeaderboardData(category);

    data.forEach((entry, index) => {
        const tr = document.createElement('tr');
        if (entry.isUser) tr.className = 'user-row';

        tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${entry.pseudo}</td>
            <td>${entry.value.toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
    });
}

function getLeaderboardData(category = 'totalXp') {
    let entries = [];

    initialBots.forEach(bot => {
        let value;
        if (category === 'totalXp') {
            value = bot.totalXp + Math.floor(Math.random() * 2000 - 1000);
        } else if (category === 'infiniteBest') {
            value = Math.floor(Math.random() * 60) + 20;
        } else if (category === 'points') {
            value = Math.floor(Math.random() * 50000) + 5000;
        }
        entries.push({ pseudo: bot.pseudo, value: Math.max(0, value) });
    });

    if (currentUser) {
        let value = 0;
        if (category === 'totalXp') value = Math.round(currentUser.totalXp || 0);
        else if (category === 'infiniteBest') value = currentUser.infiniteBest || currentUser.best || 0;
        else if (category === 'points') value = currentUser.points || 0;

        entries.push({ pseudo: currentUser.pseudo, value, isUser: true });
    }

    entries.sort((a, b) => b.value - a.value);

    const seen = new Set();
    return entries.filter(e => {
        if (seen.has(e.pseudo)) return false;
        seen.add(e.pseudo);
        return true;
    }).slice(0, 10);
}

function showLeaderboard() {
    showScreen("leaderboard");
    loadLeaderboard('totalXp');  // ouvre sur Total XP par d√©faut
}

// Active le clic + ferme si clic ailleurs
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('currentCategoryBtn');
    if (btn) btn.onclick = toggleCategoryList;

    document.addEventListener('click', e => {
        const list = document.getElementById('categoryList');
        if (list && list.style.display === 'block' && !document.getElementById('currentCategoryBtn').contains(e.target)) {
            list.style.display = 'none';
        }
    });
});
    </script>
</body>

</html>
